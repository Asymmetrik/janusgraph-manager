(()=>{"use strict";var e={389:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeBuilder=void 0,t.EdgeBuilder=class{constructor(e){this._label=e,this._multiplicity="MULTI",this._properties=[]}multiplicity(e){return this._multiplicity=e,this}property(e){return this._properties.some((t=>t.key===e.key))||this._properties.push(e),this}build(){let e=`if (!mgmt.containsEdgeLabel('${this._label}')) `;return e+=`mgmt.makeEdgeLabel('${this._label}')`,e+=null!=this._multiplicity?`.multiplicity(${this._multiplicity})`:"",e+=".make();",this._properties.length>0&&(e+="mgmt.addProperties(",e+=`mgmt.getEdgeLabel('${this._label}'), `,e+=[...this._properties].map((e=>`mgmt.getPropertyKey('${e.key}')`)).join(", "),e+=")"),e}}},480:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EnableIndexBuilder=void 0,t.EnableIndexBuilder=class{constructor(e,t="graph"){this._name=e,this._graph=t,this._action="ENABLE_INDEX"}type(e){return this._type=e,this}label(e){return"VertexCentric"!==this._type&&console.warn(`Label ${e} set on EnableIndex builder. This only applies for VertexCentric indices.`),this._label=e,this}action(e){return this._action=e,this}build(){let e="mgmt.updateIndex(";if("VertexCentric"===this._type){if(null==this._label||""===this._label)throw Error(`Vertex Centric index '${this._name}' attempted to be enabled without a label definition.`);e+=`mgmt.getRelationIndex(${this._graph}, '${this._name}', '${this._label}')`}else e+=`mgmt.getGraphIndex('${this._name}')`;return e+=`, SchemaAction.${this._action}).get();`,e}}},32:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphIndexBuilder=void 0,t.GraphIndexBuilder=class{constructor(e){this._name=e,this._keys=[]}type(e){return this._type=e,this}key(e){return this._keys.some((t=>t.field===e.field))||this._keys.push(e),this}unique(e=!1){return this._unique=e,this}label(e){return this._label=e,this}build(){if(0===this._keys.length)throw Error(`Unable to generate index ${this._name} with no key definitions.`);let e=`if (!mgmt.containsGraphIndex('${this._name}')) `;return e+=`mgmt.buildIndex('${this._name}', Vertex.class)`,e+=[...this._keys].map((e=>`.addKey(mgmt.getPropertyKey('${e.field}')${"Mixed"===this._type?`,Mapping.${e.mapping}.asParameter()`:""})`)).join(""),e+=this._unique?".unique()":"",e+=null!=this._label?`.indexOnly(mgmt.getVertexLabel('${this._label}'))`:"",e.concat("Mixed"===this._type?'.buildMixedIndex("search");':".buildCompositeIndex();")}}},638:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyBuilder=void 0,t.PropertyBuilder=class{constructor(e){this._key=e,this._cardinality="SINGLE"}cardinality(e){return this._cardinality=e,this}datatype(e){return this._datatype=e,this}build(){let e=`if (!mgmt.containsPropertyKey('${this._key}')) `;return e+=`mgmt.makePropertyKey('${this._key}')`,e+=null!=this._datatype?`.dataType(${this._datatype}.class)`:"",e+=null!=this._cardinality?`.cardinality(Cardinality.${this._cardinality})`:"",e.concat(".make();")}}},513:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VertexBuilder=void 0,t.VertexBuilder=class{constructor(e){this._label=e,this._properties=[]}property(e){return this._properties.some((t=>t.key===e.key))||this._properties.push(e),this}build(){let e=`if (!mgmt.containsVertexLabel('${this._label}')) `;return e+=`mgmt.makeVertexLabel('${this._label}')`,e+=".make();",this._properties.length>0&&(e+="mgmt.addProperties(",e+=`mgmt.getVertexLabel('${this._label}'), `,e+=[...this._properties].map((e=>`mgmt.getPropertyKey('${e.key}')`)).join(", "),e+=")"),e}}},779:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VertexCentricIndexBuilder=void 0,t.VertexCentricIndexBuilder=class{constructor(e){this._name=e,this._keys=new Set,this._order="asc"}edgelabel(e){return this._edgelabel=e,this}direction(e){return this._direction=e,this}order(e){return this._order=e,this}key(e){return this._keys.add(e),this}build(){if(0===this._keys.size)throw Error(`Unable to generate vc index ${this._name} with no key definitions.`);if(null==this._direction)throw Error(`Unable to generate vc index ${this._name} with no directionality.`);if(null==this._edgelabel||""===this._edgelabel)throw Error(`Unable to generate vc index ${this._name} with no edge label.`);let e=`if (!mgmt.containsGraphIndex('${this._name}')) `;return e+="mgmt.buildEdgeIndex(",e+=`mgmt.getEdgeLabel('${this._edgelabel}'), `,e+=`'${this._name}', `,e+=`Direction.${this._direction}, `,e+=`Order.${this._order}, `,e+=[...this._keys].map((e=>`mgmt.getPropertyKey('${e}')`)).join(", "),e.concat(");")}}},915:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WaitForIndexBuilder=void 0,t.WaitForIndexBuilder=class{constructor(e,t="graph"){this.name=e,this.graph=t}build(){return`ManagementSystem.awaitGraphIndexStatus(${this.graph}, '${this.name}').call()`}}},463:function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),a=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),a(i(389),t),a(i(480),t),a(i(32),t),a(i(638),t),a(i(513),t),a(i(779),t)}},t={};function i(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.JanusGraphManager=void 0;const t=i(463),a=i(915);e.JanusGraphManager=class{constructor(e,t){this.client=e,this.options=t,this.state="NEW",this.OPEN_MGMT=`mgmt = ${this.options.graphName}.openManagement();0;`,null==t.graphName&&(this.options.graphName="graph"),null==t.useConfiguredGraphFactory&&(this.options.useConfiguredGraphFactory=!1)}async init(){try{return"READY"!==this.state&&(this.options.useConfiguredGraphFactory?await this.client.submit(`${this.options.graphName} = ConfiguredGraphFactory.open('${this.options.graphName}');0;`):null!=this.options.configPath&&await this.client.submit(`${this.options.graphName} = JanusGraphFactory.open('${this.options.configPath}');0;`),await this.client.submit(this.OPEN_MGMT),this.state="READY"),Promise.resolve(this.state)}catch(e){return this.state="ERROR",Promise.reject(e)}}async createGraphIndex(e,i=!1){await this.init();const r=new t.GraphIndexBuilder(e.name);r.label(e.label).type(e.type).unique(e.unique),e.keys.forEach((e=>r.key(e)));try{return await this.client.submit(r.build()),i&&await this.commit(),Promise.resolve(1)}catch(e){return Promise.reject(e)}}async createVertexCentricIndex(e,i=!1){const r=new t.VertexCentricIndexBuilder(e.name);r.direction(e.direction).edgelabel(e.edgelabel).order(e.order),e.keys.forEach((e=>r.key(e)));try{return await this.init(),await this.client.submit(r.build()),i&&await this.commit(),Promise.resolve(1)}catch(e){return Promise.reject(e)}}async waitForIndices(e,t){try{return await this.init(),(await Promise.all([...e.graphIndices,...e.vcIndices].map((e=>this.waitForIndex(e,t))))).length}catch(e){return Promise.reject(e)}}async waitForIndex(e,t){const i=new a.WaitForIndexBuilder(e.name,t);try{return await this.init(),await this.client.submit(i.build()),Promise.resolve(1)}catch(e){return Promise.reject(e)}}async createIndices(e,t=!1){try{await this.init();let i=0;return i+=(await Promise.all(e.graphIndices.map((e=>this.createGraphIndex(e,t))))).length,i+=(await Promise.all(e.vcIndices.map((e=>this.createVertexCentricIndex(e,t))))).length,t&&await this.commit(),Promise.resolve(i)}catch(e){return Promise.reject(e)}}async enableIndices(e,i=!1){try{await this.init();const r=e.graphIndices.map((i=>new t.EnableIndexBuilder(i.name,e.name).action("REINDEX").build())),a=e.vcIndices.map((i=>new t.EnableIndexBuilder(i.name,e.name).type("VertexCentric").label(i.edgelabel).build())),s=(await Promise.all([...r,...a].map((e=>this.client.submit(e))))).length;return i&&await this.commit(),Promise.resolve(s)}catch(e){return Promise.reject(e)}}async createSchema(e,i=!1){try{await this.init();let r=0;return r+=(await Promise.all([...e.vertices,...e.edges].flatMap((e=>e.properties)).map((e=>new t.PropertyBuilder(e.key).datatype(e.datatype).cardinality(e.cardinality).build())).map((e=>this.client.submit(e))))).length,r+=(await Promise.all(e.vertices.map((e=>{const i=new t.VertexBuilder(e.label);return e.properties.forEach((e=>i.property(e))),i.build()})).map((e=>this.client.submit(e))))).length,r+=(await Promise.all(e.edges.map((e=>{const i=new t.EdgeBuilder(e.label);return e.properties.forEach((e=>i.property(e))),i.build()})).map((e=>this.client.submit(e))))).length,i&&(await this.commit(),r+=await this.createIndices(e)),Promise.resolve(r)}catch(e){return Promise.reject(e)}}async getIndices(){try{await this.init();const e=await this.client.submit("mgmt.getGraphIndexes(Vertex.class)");return Promise.resolve(e._items)}catch(e){return Promise.reject(e)}}async commit(e){try{await this.init();const t=await this.client.submit(`${e??""};mgmt.commit();`);return this.state="COMMIT",t}catch(e){return this.state="ERROR",Promise.reject(e)}}async close(){try{if(["CLOSED","ERROR"].some((e=>e===this.state)))return;const e=await this.client.close();return this.state="CLOSED",e}catch(e){return this.state="ERROR",Promise.reject(e)}}}})(),exports.janusgraphmanager=r})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qYW51c2dyYXBobWFuYWdlci8uL3NyYy9idWlsZGVycy9FZGdlQnVpbGRlci50cyIsIndlYnBhY2s6Ly9qYW51c2dyYXBobWFuYWdlci8uL3NyYy9idWlsZGVycy9FbmFibGVJbmRleEJ1aWxkZXIudHMiLCJ3ZWJwYWNrOi8vamFudXNncmFwaG1hbmFnZXIvLi9zcmMvYnVpbGRlcnMvR3JhcGhJbmRleEJ1aWxkZXIudHMiLCJ3ZWJwYWNrOi8vamFudXNncmFwaG1hbmFnZXIvLi9zcmMvYnVpbGRlcnMvUHJvcGVydHlCdWlsZGVyLnRzIiwid2VicGFjazovL2phbnVzZ3JhcGhtYW5hZ2VyLy4vc3JjL2J1aWxkZXJzL1ZlcnRleEJ1aWxkZXIudHMiLCJ3ZWJwYWNrOi8vamFudXNncmFwaG1hbmFnZXIvLi9zcmMvYnVpbGRlcnMvVmVydGV4Q2VudHJpY0luZGV4QnVpbGRlci50cyIsIndlYnBhY2s6Ly9qYW51c2dyYXBobWFuYWdlci8uL3NyYy9idWlsZGVycy9XYWl0Rm9ySW5kZXhCdWlsZGVyLnRzIiwid2VicGFjazovL2phbnVzZ3JhcGhtYW5hZ2VyLy4vc3JjL2J1aWxkZXJzL2luZGV4LnRzIiwid2VicGFjazovL2phbnVzZ3JhcGhtYW5hZ2VyL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2phbnVzZ3JhcGhtYW5hZ2VyLy4vc3JjL0phbnVzR3JhcGhNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbIl9sYWJlbCIsIl9tdWx0aXBsaWNpdHkiLCJfcHJvcGVydGllcyIsIm11bHRpcGxpY2l0eSIsInRoaXMiLCJwcm9wZXJ0eSIsInNvbWUiLCJwIiwia2V5IiwicHVzaCIsIm91dHB1dCIsImxlbmd0aCIsIm1hcCIsInByb3AiLCJqb2luIiwiX25hbWUiLCJfZ3JhcGgiLCJfYWN0aW9uIiwidHlwZSIsIl90eXBlIiwibGFiZWwiLCJjb25zb2xlIiwid2FybiIsImFjdGlvbiIsIkVycm9yIiwiX2tleXMiLCJrIiwiZmllbGQiLCJ1bmlxdWUiLCJfdW5pcXVlIiwibWFwcGluZyIsImNvbmNhdCIsIl9rZXkiLCJfY2FyZGluYWxpdHkiLCJjYXJkaW5hbGl0eSIsImRhdGF0eXBlIiwiX2RhdGF0eXBlIiwiU2V0IiwiX29yZGVyIiwiZWRnZWxhYmVsIiwiX2VkZ2VsYWJlbCIsImRpcmVjdGlvbiIsIl9kaXJlY3Rpb24iLCJvcmRlciIsImFkZCIsInNpemUiLCJuYW1lIiwiZ3JhcGgiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImNhbGwiLCJjbGllbnQiLCJvcHRpb25zIiwic3RhdGUiLCJPUEVOX01HTVQiLCJncmFwaE5hbWUiLCJ1c2VDb25maWd1cmVkR3JhcGhGYWN0b3J5Iiwic3VibWl0IiwiY29uZmlnUGF0aCIsIlByb21pc2UiLCJyZXNvbHZlIiwiZXJyIiwicmVqZWN0IiwiaW5kZXgiLCJjb21taXQiLCJpbml0IiwiYnVpbGRlciIsIkdyYXBoSW5kZXhCdWlsZGVyIiwia2V5cyIsImZvckVhY2giLCJidWlsZCIsIlZlcnRleENlbnRyaWNJbmRleEJ1aWxkZXIiLCJzY2hlbWEiLCJhbGwiLCJncmFwaEluZGljZXMiLCJ2Y0luZGljZXMiLCJpIiwid2FpdEZvckluZGV4IiwiV2FpdEZvckluZGV4QnVpbGRlciIsImNvdW50IiwiY3JlYXRlR3JhcGhJbmRleCIsImNyZWF0ZVZlcnRleENlbnRyaWNJbmRleCIsImdpIiwiRW5hYmxlSW5kZXhCdWlsZGVyIiwidmNpIiwibXNnIiwiaW5kaWNlcyIsInZlcnRpY2VzIiwiZWRnZXMiLCJmbGF0TWFwIiwidiIsInByb3BlcnRpZXMiLCJQcm9wZXJ0eUJ1aWxkZXIiLCJWZXJ0ZXhCdWlsZGVyIiwiZSIsIkVkZ2VCdWlsZGVyIiwiY3JlYXRlSW5kaWNlcyIsImRhdGEiLCJfaXRlbXMiLCJtZXNzYWdlIiwicyIsImNs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RUgsV0FBV3RCLFNBQVNwRSxHQUFNaUUsRUFBUW5FLFNBQVNFLEtBQ3RDaUUsRUFBUUksV0FFbEJoRSxLQUFLK0UsR0FBUXZGLEtBQUtxRCxPQUFPTSxPQUFPNEIsT0FFM0NoRixPQUNFaUYsVUFDTXhGLEtBQUtrRSxTQUNYZSxTQUFlakYsS0FBS2tHLGNBQWN4QixJQUUvQmIsUUFBUUMsUUFBUW1CLEdBQ3pCLE1BQU9sQixHQUNMLE9BQU9GLFFBQVFHLE9BQU9ELElBSTlCLG1CQUNJLFVBQ1UvRCxLQUFLbUUsT0FDWCxNQUFNZ0MsUUFBY25HLEtBQUtxRCxPQUFPTSxPQUFPLHNDQUN2QyxPQUFPRSxRQUFRQyxRQUFRcUMsRUFBS0MsUUFDOUIsTUFBT3JDLEdBQ0wsT0FBT0YsUUFBUUcsT0FBT0QsSUFTOUIsYUFBYXNDLEdBQ1QsVUFDVXJHLEtBQUttRSxPQUNYLE1BQU1ELFFBQWVsRSxLQUFLcUQsT0FBT00sT0FDN0IsR0FBRzBDLEdBQVcscUJBR2xCLE9BREFyRyxLQUFLdUQsTUFBUSxTQUNOVyxFQUNULE1BQU9ILEdBRUwsT0FEQS9ELEtBQUt1RCxNQUFRLFFBQ05NLFFBQVFHLE9BQU9ELElBUTlCLGNBQ0ksSUFDSSxHQUFJLENBQUMsU0FBVSxTQUFTN0QsTUFBTW9HLEdBQU1BLElBQU10RyxLQUFLdUQsUUFBUSxPQUN2RCxNQUFNZ0QsUUFBY3ZHLEtBQUtxRCxPQUFPa0QsUUFFaEMsT0FEQXZHLEtBQUt1RCxNQUFRLFNBQ05nRCxFQUNULE1BQU94QyxHQUVMLE9BREEvRCxLQUFLdUQsTUFBUSxRQUNOTSxRQUFRRyxPQUFPRCxPIiwiZmlsZSI6ImluZGV4Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJ1aWxkZXIgfSBmcm9tIFwiLi9CdWlsZGVyLmludGVyZmFjZVwiO1xuaW1wb3J0IHsgRWRnZU11bHRpcGxpY2l0eSB9IGZyb20gXCIuLi90eXBlcy9FZGdlXCI7XG5pbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gXCIuLi90eXBlcy9Qcm9wZXJ0eVwiO1xuXG5leHBvcnQgY2xhc3MgRWRnZUJ1aWxkZXIgaW1wbGVtZW50cyBCdWlsZGVyPHN0cmluZz4ge1xuICAgIHByaXZhdGUgX211bHRpcGxpY2l0eTogRWRnZU11bHRpcGxpY2l0eSA9IFwiTVVMVElcIjtcbiAgICBwcml2YXRlIF9wcm9wZXJ0aWVzOiBQcm9wZXJ0eVtdID0gW107XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9sYWJlbDogc3RyaW5nKSB7fVxuXG4gICAgbXVsdGlwbGljaXR5KG11bHRpcGxpY2l0eTogRWRnZU11bHRpcGxpY2l0eSk6IHRoaXMge1xuICAgICAgICB0aGlzLl9tdWx0aXBsaWNpdHkgPSBtdWx0aXBsaWNpdHk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHByb3BlcnR5KHByb3BlcnR5OiBQcm9wZXJ0eSk6IHRoaXMge1xuICAgICAgICBpZiAodGhpcy5fcHJvcGVydGllcy5zb21lKChwKSA9PiBwLmtleSA9PT0gcHJvcGVydHkua2V5KSkgcmV0dXJuIHRoaXM7XG4gICAgICAgIHRoaXMuX3Byb3BlcnRpZXMucHVzaChwcm9wZXJ0eSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGJ1aWxkKCk6IHN0cmluZyB7XG4gICAgICAgIGxldCBvdXRwdXQgPSBgaWYgKCFtZ210LmNvbnRhaW5zRWRnZUxhYmVsKCcke3RoaXMuX2xhYmVsfScpKSBgO1xuICAgICAgICBvdXRwdXQgKz0gYG1nbXQubWFrZUVkZ2VMYWJlbCgnJHt0aGlzLl9sYWJlbH0nKWA7XG4gICAgICAgIG91dHB1dCArPVxuICAgICAgICAgICAgdGhpcy5fbXVsdGlwbGljaXR5ICE9IG51bGxcbiAgICAgICAgICAgICAgICA/IGAubXVsdGlwbGljaXR5KCR7dGhpcy5fbXVsdGlwbGljaXR5fSlgXG4gICAgICAgICAgICAgICAgOiBcIlwiO1xuICAgICAgICBvdXRwdXQgKz0gXCIubWFrZSgpO1wiO1xuICAgICAgICBpZiAodGhpcy5fcHJvcGVydGllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBvdXRwdXQgKz0gXCJtZ210LmFkZFByb3BlcnRpZXMoXCI7XG4gICAgICAgICAgICBvdXRwdXQgKz0gYG1nbXQuZ2V0RWRnZUxhYmVsKCcke3RoaXMuX2xhYmVsfScpLCBgO1xuICAgICAgICAgICAgb3V0cHV0ICs9IFsuLi50aGlzLl9wcm9wZXJ0aWVzXVxuICAgICAgICAgICAgICAgIC5tYXAoKHByb3ApID0+IGBtZ210LmdldFByb3BlcnR5S2V5KCcke3Byb3Aua2V5fScpYClcbiAgICAgICAgICAgICAgICAuam9pbihcIiwgXCIpO1xuICAgICAgICAgICAgb3V0cHV0ICs9IFwiKVwiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgSW5kZXhUeXBlIH0gZnJvbSAnLi4vdHlwZXMvR3JhcGhJbmRleCc7XG5pbXBvcnQgeyBCdWlsZGVyIH0gZnJvbSAnLi9CdWlsZGVyLmludGVyZmFjZSc7XG5cbmV4cG9ydCB0eXBlIFNjaGVtYUFjdGlvbiA9IFwiRU5BQkxFX0lOREVYXCIgfCBcIlJFSU5ERVhcIjtcblxuLyoqXG4gKiBCdWlsZHMgYSBtYW5hZ2VtZW50IHN0cmluZyB0aGF0IGF0dGVtcHRzIHRvIGVuYWJsZSBhIHNwZWNpZmljIGluZGV4LlxuICovXG5leHBvcnQgY2xhc3MgRW5hYmxlSW5kZXhCdWlsZGVyIGltcGxlbWVudHMgQnVpbGRlcjxzdHJpbmc+IHtcbiAgICBwcml2YXRlIF90eXBlITogSW5kZXhUeXBlO1xuICAgIHByaXZhdGUgX2xhYmVsITogc3RyaW5nO1xuICAgIHByaXZhdGUgX2FjdGlvbjogU2NoZW1hQWN0aW9uID0gJ0VOQUJMRV9JTkRFWCc7XG5cbiAgICAvKipcbiAgICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yLlxuICAgICAqIEBwYXJhbSBfbmFtZSBJbmRleCB0byBhdHRlbXB0IHRvIGVuYWJsZS5cbiAgICAgKiBAcGFyYW0gX2dyYXBoIEdyYXBoIG5hbWUgdGhhdCB0aGUgaW5kZXggcmVzaWRlcyBvbi4gRGVmYXVsdCBgZ3JhcGhgLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX25hbWU6IHN0cmluZywgcHJpdmF0ZSBfZ3JhcGg6IHN0cmluZyA9ICdncmFwaCcpIHt9XG5cbiAgICB0eXBlKHR5cGU6IEluZGV4VHlwZSk6IHRoaXMge1xuICAgICAgICB0aGlzLl90eXBlID0gdHlwZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgdmVydGV4IGxhYmVsIGZvciBWZXJ0ZXhDZW50cmljIGluZGljaWVzLlxuICAgICAqIEBwYXJhbSBsYWJlbCBMYWJlbFxuICAgICAqIEByZXR1cm5zIFRoZSBidWlsZGVyLlxuICAgICAqL1xuICAgIGxhYmVsKGxhYmVsOiBzdHJpbmcpOiB0aGlzIHtcbiAgICAgICAgaWYgKHRoaXMuX3R5cGUgIT09ICdWZXJ0ZXhDZW50cmljJykge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgICAgIGBMYWJlbCAke2xhYmVsfSBzZXQgb24gRW5hYmxlSW5kZXggYnVpbGRlci4gVGhpcyBvbmx5IGFwcGxpZXMgZm9yIFZlcnRleENlbnRyaWMgaW5kaWNlcy5gXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2xhYmVsID0gbGFiZWw7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGFjdGlvbihhY3Rpb246IFNjaGVtYUFjdGlvbik6IHRoaXMge1xuICAgICAgICB0aGlzLl9hY3Rpb24gPSBhY3Rpb247XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyB0aGUgb3V0cHV0IHN0cmluZy5cbiAgICAgKiBAcmV0dXJucyBTdHJpbmcgdGhhdCBjYWxscyBFTkFCTEVfSU5ERVggaW4gSkcuXG4gICAgICogQHRocm93cyBBbiBFcnJvciBpZiBhbiBhdHRlbXB0IGlzIG1hZGUgdG8gZW5hYmxlIGEgVmVydGV4Q2VudHJpYyBpbmRleCB3aXRob3V0IGEgbGFiZWwuXG4gICAgICovXG4gICAgYnVpbGQoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG91dHB1dCA9ICdtZ210LnVwZGF0ZUluZGV4KCc7XG4gICAgICAgIGlmICh0aGlzLl90eXBlID09PSAnVmVydGV4Q2VudHJpYycpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9sYWJlbCA9PSBudWxsIHx8IHRoaXMuX2xhYmVsID09PSAnJylcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAgICAgICAgICAgYFZlcnRleCBDZW50cmljIGluZGV4ICcke3RoaXMuX25hbWV9JyBhdHRlbXB0ZWQgdG8gYmUgZW5hYmxlZCB3aXRob3V0IGEgbGFiZWwgZGVmaW5pdGlvbi5gXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIG91dHB1dCArPSBgbWdtdC5nZXRSZWxhdGlvbkluZGV4KCR7dGhpcy5fZ3JhcGh9LCAnJHt0aGlzLl9uYW1lfScsICcke3RoaXMuX2xhYmVsfScpYDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG91dHB1dCArPSBgbWdtdC5nZXRHcmFwaEluZGV4KCcke3RoaXMuX25hbWV9JylgO1xuICAgICAgICB9XG4gICAgICAgIG91dHB1dCArPSBgLCBTY2hlbWFBY3Rpb24uJHt0aGlzLl9hY3Rpb259KS5nZXQoKTtgO1xuICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEJ1aWxkZXIgfSBmcm9tICcuL0J1aWxkZXIuaW50ZXJmYWNlJztcbmltcG9ydCB7IENvbXBvc2l0ZU9yTWl4ZWRJbmRleFR5cGUsIEluZGV4S2V5IH0gZnJvbSAnLi4vdHlwZXMvR3JhcGhJbmRleCc7XG5cbi8qKlxuICogSW5kZXggQnVpbGRlciBmb3IgQ29tcG9zaXRlIG9yIE1peGVkIGluZGljZXMuXG4gKlxuICogRm9yIFZlcnRleENlbnRyaWMgaW5kaWNpZXMsIHBsZWFzZSB1c2Uge0BsaW5rIFZlcnRleENlbnRyaWNJbmRleEJ1aWxkZXJ9XG4gKi9cbmV4cG9ydCBjbGFzcyBHcmFwaEluZGV4QnVpbGRlciBpbXBsZW1lbnRzIEJ1aWxkZXI8c3RyaW5nPiB7XG4gICAgcHJpdmF0ZSBfdHlwZT86IENvbXBvc2l0ZU9yTWl4ZWRJbmRleFR5cGU7XG4gICAgcHJpdmF0ZSBfa2V5czogSW5kZXhLZXlbXSA9IFtdO1xuICAgIHByaXZhdGUgX3VuaXF1ZT86IGJvb2xlYW47XG4gICAgcHJpdmF0ZSBfbGFiZWw/OiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9uYW1lOiBzdHJpbmcpIHt9XG5cbiAgICB0eXBlKHR5cGU6IENvbXBvc2l0ZU9yTWl4ZWRJbmRleFR5cGUpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5fdHlwZSA9IHR5cGU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGtleShrZXk6IEluZGV4S2V5KTogdGhpcyB7XG4gICAgICAgIGlmICh0aGlzLl9rZXlzLnNvbWUoKGspID0+IGsuZmllbGQgPT09IGtleS5maWVsZCkpIHJldHVybiB0aGlzO1xuICAgICAgICB0aGlzLl9rZXlzLnB1c2goa2V5KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgdW5pcXVlKHVuaXF1ZSA9IGZhbHNlKTogdGhpcyB7XG4gICAgICAgIHRoaXMuX3VuaXF1ZSA9IHVuaXF1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgbGFiZWwobGFiZWw/OiBzdHJpbmcpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5fbGFiZWwgPSBsYWJlbDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgYnVpbGQoKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMuX2tleXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAgICAgICBgVW5hYmxlIHRvIGdlbmVyYXRlIGluZGV4ICR7dGhpcy5fbmFtZX0gd2l0aCBubyBrZXkgZGVmaW5pdGlvbnMuYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgb3V0cHV0ID0gYGlmICghbWdtdC5jb250YWluc0dyYXBoSW5kZXgoJyR7dGhpcy5fbmFtZX0nKSkgYDtcbiAgICAgICAgb3V0cHV0ICs9IGBtZ210LmJ1aWxkSW5kZXgoJyR7dGhpcy5fbmFtZX0nLCBWZXJ0ZXguY2xhc3MpYDtcbiAgICAgICAgb3V0cHV0ICs9IFsuLi50aGlzLl9rZXlzXVxuICAgICAgICAgICAgLm1hcChcbiAgICAgICAgICAgICAgICAoa2V5KSA9PlxuICAgICAgICAgICAgICAgICAgICBgLmFkZEtleShtZ210LmdldFByb3BlcnR5S2V5KCcke2tleS5maWVsZH0nKSR7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90eXBlID09PSAnTWl4ZWQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBgLE1hcHBpbmcuJHtrZXkubWFwcGluZ30uYXNQYXJhbWV0ZXIoKWBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICcnXG4gICAgICAgICAgICAgICAgICAgIH0pYFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmpvaW4oJycpO1xuICAgICAgICBvdXRwdXQgKz0gdGhpcy5fdW5pcXVlID8gYC51bmlxdWUoKWAgOiAnJztcbiAgICAgICAgb3V0cHV0ICs9XG4gICAgICAgICAgICB0aGlzLl9sYWJlbCAhPSBudWxsXG4gICAgICAgICAgICAgICAgPyBgLmluZGV4T25seShtZ210LmdldFZlcnRleExhYmVsKCcke3RoaXMuX2xhYmVsfScpKWBcbiAgICAgICAgICAgICAgICA6ICcnO1xuICAgICAgICByZXR1cm4gb3V0cHV0LmNvbmNhdChcbiAgICAgICAgICAgIHRoaXMuX3R5cGUgPT09ICdNaXhlZCdcbiAgICAgICAgICAgICAgICA/ICcuYnVpbGRNaXhlZEluZGV4KFwic2VhcmNoXCIpOydcbiAgICAgICAgICAgICAgICA6ICcuYnVpbGRDb21wb3NpdGVJbmRleCgpOydcbiAgICAgICAgKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBCdWlsZGVyIH0gZnJvbSBcIi4vQnVpbGRlci5pbnRlcmZhY2VcIjtcbmltcG9ydCB7IFByb3BlcnR5Q2FyZGluYWxpdHksIFByb3BlcnR5VHlwZSB9IGZyb20gXCIuLi90eXBlcy9Qcm9wZXJ0eVwiO1xuXG5leHBvcnQgY2xhc3MgUHJvcGVydHlCdWlsZGVyIGltcGxlbWVudHMgQnVpbGRlcjxzdHJpbmc+IHtcbiAgICBwcml2YXRlIF9kYXRhdHlwZSE6IFByb3BlcnR5VHlwZTtcbiAgICBwcml2YXRlIF9jYXJkaW5hbGl0eTogUHJvcGVydHlDYXJkaW5hbGl0eSA9IFwiU0lOR0xFXCI7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9rZXk6IHN0cmluZykge31cblxuICAgIGNhcmRpbmFsaXR5KGNhcmRpbmFsaXR5OiBQcm9wZXJ0eUNhcmRpbmFsaXR5KTogdGhpcyB7XG4gICAgICAgIHRoaXMuX2NhcmRpbmFsaXR5ID0gY2FyZGluYWxpdHk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGRhdGF0eXBlKGRhdGF0eXBlOiBQcm9wZXJ0eVR5cGUpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5fZGF0YXR5cGUgPSBkYXRhdHlwZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgYnVpbGQoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG91dHB1dCA9IGBpZiAoIW1nbXQuY29udGFpbnNQcm9wZXJ0eUtleSgnJHt0aGlzLl9rZXl9JykpIGA7XG4gICAgICAgIG91dHB1dCArPSBgbWdtdC5tYWtlUHJvcGVydHlLZXkoJyR7dGhpcy5fa2V5fScpYDtcbiAgICAgICAgb3V0cHV0ICs9XG4gICAgICAgICAgICB0aGlzLl9kYXRhdHlwZSAhPSBudWxsID8gYC5kYXRhVHlwZSgke3RoaXMuX2RhdGF0eXBlfS5jbGFzcylgIDogXCJcIjtcbiAgICAgICAgb3V0cHV0ICs9XG4gICAgICAgICAgICB0aGlzLl9jYXJkaW5hbGl0eSAhPSBudWxsXG4gICAgICAgICAgICAgICAgPyBgLmNhcmRpbmFsaXR5KENhcmRpbmFsaXR5LiR7dGhpcy5fY2FyZGluYWxpdHl9KWBcbiAgICAgICAgICAgICAgICA6IFwiXCI7XG4gICAgICAgIHJldHVybiBvdXRwdXQuY29uY2F0KFwiLm1ha2UoKTtcIik7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgQnVpbGRlciB9IGZyb20gJy4vQnVpbGRlci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tICcuLi90eXBlcy9Qcm9wZXJ0eSc7XG5cbmV4cG9ydCBjbGFzcyBWZXJ0ZXhCdWlsZGVyIGltcGxlbWVudHMgQnVpbGRlcjxzdHJpbmc+IHtcbiAgICBwcml2YXRlIF9wcm9wZXJ0aWVzOiBQcm9wZXJ0eVtdID0gW107XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9sYWJlbDogc3RyaW5nKSB7fVxuXG4gICAgcHJvcGVydHkocHJvcGVydHk6IFByb3BlcnR5KTogdGhpcyB7XG4gICAgICAgIGlmICh0aGlzLl9wcm9wZXJ0aWVzLnNvbWUoKHApID0+IHAua2V5ID09PSBwcm9wZXJ0eS5rZXkpKSByZXR1cm4gdGhpcztcbiAgICAgICAgdGhpcy5fcHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgYnVpbGQoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG91dHB1dCA9IGBpZiAoIW1nbXQuY29udGFpbnNWZXJ0ZXhMYWJlbCgnJHt0aGlzLl9sYWJlbH0nKSkgYDtcbiAgICAgICAgb3V0cHV0ICs9IGBtZ210Lm1ha2VWZXJ0ZXhMYWJlbCgnJHt0aGlzLl9sYWJlbH0nKWA7XG4gICAgICAgIG91dHB1dCArPSAnLm1ha2UoKTsnO1xuICAgICAgICBpZiAodGhpcy5fcHJvcGVydGllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBvdXRwdXQgKz0gJ21nbXQuYWRkUHJvcGVydGllcygnO1xuICAgICAgICAgICAgb3V0cHV0ICs9IGBtZ210LmdldFZlcnRleExhYmVsKCcke3RoaXMuX2xhYmVsfScpLCBgO1xuICAgICAgICAgICAgb3V0cHV0ICs9IFsuLi50aGlzLl9wcm9wZXJ0aWVzXVxuICAgICAgICAgICAgICAgIC5tYXAoKHByb3ApID0+IGBtZ210LmdldFByb3BlcnR5S2V5KCcke3Byb3Aua2V5fScpYClcbiAgICAgICAgICAgICAgICAuam9pbignLCAnKTtcbiAgICAgICAgICAgIG91dHB1dCArPSAnKSc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBCdWlsZGVyIH0gZnJvbSBcIi4vQnVpbGRlci5pbnRlcmZhY2VcIjtcbmltcG9ydCB7IERpcmVjdGlvbiwgT3JkZXIgfSBmcm9tIFwiLi4vdHlwZXMvVmVydGV4Q2VudHJpY0luZGV4XCI7XG5cbi8qKlxuICogSW5kZXggQnVpbGRlciBmb3IgVmVydGV4IENlbnRyaWMgaW5kaWNlcy5cbiAqIFxuICogRm9yIE1peGVkL0NvbXBvc2l0ZSwgcGxlYXNlIHVzZSB7QGxpbmsgSW5kZXhCdWlsZGVyfVxuICovXG5leHBvcnQgY2xhc3MgVmVydGV4Q2VudHJpY0luZGV4QnVpbGRlciBpbXBsZW1lbnRzIEJ1aWxkZXI8c3RyaW5nPiB7XG4gICAgcHJpdmF0ZSBfa2V5czogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG4gICAgcHJpdmF0ZSBfZGlyZWN0aW9uITogRGlyZWN0aW9uO1xuICAgIHByaXZhdGUgX29yZGVyOiBPcmRlciA9IFwiYXNjXCI7XG4gICAgcHJpdmF0ZSBfZWRnZWxhYmVsITogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfbmFtZTogc3RyaW5nKSB7fVxuXG4gICAgZWRnZWxhYmVsKGVkZ2VsYWJlbDogc3RyaW5nKTogdGhpcyB7XG4gICAgICAgIHRoaXMuX2VkZ2VsYWJlbCA9IGVkZ2VsYWJlbDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgZGlyZWN0aW9uKGRpcmVjdGlvbjogRGlyZWN0aW9uKTogdGhpcyB7XG4gICAgICAgIHRoaXMuX2RpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgb3JkZXIob3JkZXI6IE9yZGVyKTogdGhpcyB7XG4gICAgICAgIHRoaXMuX29yZGVyID0gb3JkZXI7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGtleShrZXk6IHN0cmluZyk6IHRoaXMge1xuICAgICAgICB0aGlzLl9rZXlzLmFkZChrZXkpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBidWlsZCgpOiBzdHJpbmcge1xuICAgICAgICBpZiAodGhpcy5fa2V5cy5zaXplID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgVW5hYmxlIHRvIGdlbmVyYXRlIHZjIGluZGV4ICR7dGhpcy5fbmFtZX0gd2l0aCBubyBrZXkgZGVmaW5pdGlvbnMuYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2RpcmVjdGlvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgVW5hYmxlIHRvIGdlbmVyYXRlIHZjIGluZGV4ICR7dGhpcy5fbmFtZX0gd2l0aCBubyBkaXJlY3Rpb25hbGl0eS5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fZWRnZWxhYmVsID09IG51bGwgfHwgdGhpcy5fZWRnZWxhYmVsID09PSAnJykge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYFVuYWJsZSB0byBnZW5lcmF0ZSB2YyBpbmRleCAke3RoaXMuX25hbWV9IHdpdGggbm8gZWRnZSBsYWJlbC5gKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgb3V0cHV0ID0gYGlmICghbWdtdC5jb250YWluc0dyYXBoSW5kZXgoJyR7dGhpcy5fbmFtZX0nKSkgYDtcbiAgICAgICAgb3V0cHV0ICs9IGBtZ210LmJ1aWxkRWRnZUluZGV4KGA7XG4gICAgICAgIG91dHB1dCArPSBgbWdtdC5nZXRFZGdlTGFiZWwoJyR7dGhpcy5fZWRnZWxhYmVsfScpLCBgO1xuICAgICAgICBvdXRwdXQgKz0gYCcke3RoaXMuX25hbWV9JywgYDtcbiAgICAgICAgb3V0cHV0ICs9IGBEaXJlY3Rpb24uJHt0aGlzLl9kaXJlY3Rpb259LCBgO1xuICAgICAgICBvdXRwdXQgKz0gYE9yZGVyLiR7dGhpcy5fb3JkZXJ9LCBgO1xuICAgICAgICBvdXRwdXQgKz0gWy4uLnRoaXMuX2tleXNdXG4gICAgICAgICAgICAubWFwKChrZXkpID0+IGBtZ210LmdldFByb3BlcnR5S2V5KCcke2tleX0nKWApXG4gICAgICAgICAgICAuam9pbihcIiwgXCIpO1xuICAgICAgICByZXR1cm4gb3V0cHV0LmNvbmNhdChcIik7XCIpO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEJ1aWxkZXIgfSBmcm9tICcuL0J1aWxkZXIuaW50ZXJmYWNlJztcblxuLyoqXG4gKiBCdWlsZHMgYSBzdHJpbmcgdGhhdCBpbnN0cnVjdHMgdGhlIG1hbmFnZW1lbnQgc3lzdGVtIHRvIHdhaXQgZm9yIGFuIGluZGV4IHRvIGJlY29tZSBhdmFpbGFibGUuXG4gKi9cbmV4cG9ydCBjbGFzcyBXYWl0Rm9ySW5kZXhCdWlsZGVyIGltcGxlbWVudHMgQnVpbGRlcjxzdHJpbmc+IHtcbiAgICAvKipcbiAgICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yLlxuICAgICAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGluZGV4IHRvIHdhaXQgZm9yLlxuICAgICAqIEBwYXJhbSBncmFwaCBOYW1lIG9mIHRoZSBncmFwaCB0byB1c2UuIERlZmF1bHQgaXMgYGdyYXBoYFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbmFtZTogc3RyaW5nLCBwcml2YXRlIGdyYXBoID0gJ2dyYXBoJykge31cblxuICAgIGJ1aWxkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgTWFuYWdlbWVudFN5c3RlbS5hd2FpdEdyYXBoSW5kZXhTdGF0dXMoJHt0aGlzLmdyYXBofSwgJyR7dGhpcy5uYW1lfScpLmNhbGwoKWA7XG4gICAgfVxufVxuIiwiZXhwb3J0ICogZnJvbSBcIi4vRWRnZUJ1aWxkZXJcIjtcbmV4cG9ydCAqIGZyb20gXCIuL0VuYWJsZUluZGV4QnVpbGRlclwiO1xuZXhwb3J0ICogZnJvbSBcIi4vR3JhcGhJbmRleEJ1aWxkZXJcIjtcbmV4cG9ydCAqIGZyb20gXCIuL1Byb3BlcnR5QnVpbGRlclwiO1xuZXhwb3J0ICogZnJvbSBcIi4vVmVydGV4QnVpbGRlclwiO1xuZXhwb3J0ICogZnJvbSBcIi4vVmVydGV4Q2VudHJpY0luZGV4QnVpbGRlclwiOyIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCJpbXBvcnQgeyBkcml2ZXIgfSBmcm9tICdncmVtbGluJztcbmltcG9ydCB7IEdyYXBoU2NoZW1hIH0gZnJvbSAnLi90eXBlcy9HcmFwaFNjaGVtYSc7XG5pbXBvcnQge1xuICAgIEVkZ2VCdWlsZGVyLFxuICAgIEVuYWJsZUluZGV4QnVpbGRlcixcbiAgICBHcmFwaEluZGV4QnVpbGRlcixcbiAgICBQcm9wZXJ0eUJ1aWxkZXIsXG4gICAgVmVydGV4QnVpbGRlcixcbiAgICBWZXJ0ZXhDZW50cmljSW5kZXhCdWlsZGVyLFxufSBmcm9tICcuL2J1aWxkZXJzJztcbmltcG9ydCB7IEdyYXBoSW5kZXggfSBmcm9tICcuL3R5cGVzL0dyYXBoSW5kZXgnO1xuaW1wb3J0IHsgVmVydGV4Q2VudHJpY0luZGV4IH0gZnJvbSAnLi90eXBlcy9WZXJ0ZXhDZW50cmljSW5kZXgnO1xuaW1wb3J0IHsgV2FpdEZvckluZGV4QnVpbGRlciB9IGZyb20gJy4vYnVpbGRlcnMvV2FpdEZvckluZGV4QnVpbGRlcic7XG5cbnR5cGUgTWFuYWdlclN0YXRlID0gJ05FVycgfCAnUkVBRFknIHwgJ0NPTU1JVCcgfCAnRVJST1InIHwgJ0NMT1NFRCc7XG5cbmV4cG9ydCB0eXBlIEphbnVzR3JhcGhNYW5nZXJPcHRpb25zID0ge1xuICAgIC8qKlxuICAgICAqIE5hbWUgb2YgdGhlIGdyYXBoIHRvIHRyYXZlcnNlLlxuICAgICAqL1xuICAgIGdyYXBoTmFtZT86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0byB1c2UgdGhlIENvbmZpZ3VyZWRHcmFwaEZhY3RvcnkgZm9yIGR5bmFtaWMgZ3JhcGhzLlxuICAgICAqL1xuICAgIHVzZUNvbmZpZ3VyZWRHcmFwaEZhY3Rvcnk/OiBib29sZWFuO1xuICAgIC8qKlxuICAgICAqIFBhdGggdG8gYSBKYW51c0dyYXBoRmFjdG9yeSBjb25maWd1cmF0aW9uIG9uIHRoZSByZW1vdGUsIGZvciB1c2Ugd2l0aCBKYW51c0dyYXBoRmFjdG9yeS5cbiAgICAgKi9cbiAgICBjb25maWdQYXRoPzogc3RyaW5nO1xufTtcblxuZXhwb3J0IGNsYXNzIEphbnVzR3JhcGhNYW5hZ2VyIHtcbiAgICBwcml2YXRlIHN0YXRlOiBNYW5hZ2VyU3RhdGUgPSAnTkVXJztcblxuICAgIHByaXZhdGUgT1BFTl9NR01UID0gYG1nbXQgPSAke3RoaXMub3B0aW9ucy5ncmFwaE5hbWV9Lm9wZW5NYW5hZ2VtZW50KCk7MDtgO1xuXG4gICAgLyoqXG4gICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci5cbiAgICAgKiBAcGFyYW0gY2xpZW50IEEgcHJlY29uZmlndXJlZCBncmVtbGluIGNsaWVudCBmb3IgYWNjZXNzaW5nIGdyZW1saW4tc2VydmVyLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIEphbnVzR3JhcGhPcHRpb25zIGZvciBhY2Nlc3NpbmcgdGhlIGdyYXBoOlxuICAgICAqIC0gZ3JhcGhOYW1lIHdpbGwgaGF2ZSBhIGRlZmF1bHQgb2YgYCdncmFwaCdgLlxuICAgICAqIC0gdXNlQ29uZmlndXJlZEdyYXBoRmFjdG9yeSB3aWxsIGhhdmUgYSBkZWZhdWx0IG9mIGBmYWxzZWBcbiAgICAgKiAtIGNvbmZpZ1BhdGggaGFzIG5vIGRlZmF1bHQuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgY2xpZW50OiBkcml2ZXIuQ2xpZW50LFxuICAgICAgICBwcml2YXRlIG9wdGlvbnM6IEphbnVzR3JhcGhNYW5nZXJPcHRpb25zXG4gICAgKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmdyYXBoTmFtZSA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuZ3JhcGhOYW1lID0gJ2dyYXBoJztcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy51c2VDb25maWd1cmVkR3JhcGhGYWN0b3J5ID09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy51c2VDb25maWd1cmVkR3JhcGhGYWN0b3J5ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVucyB0aGUgbWFuYWdlbWVudCBzeXN0ZW0gZm9yIHRoZSBjbGllbnQgc2Vzc2lvbi5cbiAgICAgKiBAcmV0dXJucyBBIHByb21pc2Ugd2l0aCB0aGUgc3RhdGUgb2YgdGhlIG1hbmFnZXIuXG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyBpbml0KCk6IFByb21pc2U8TWFuYWdlclN0YXRlPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gJ1JFQURZJykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudXNlQ29uZmlndXJlZEdyYXBoRmFjdG9yeSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgXCI7MDtcIiBpcyBhIHdlaXJkIHdvcmsgYXJvdW5kIHRvIHByZXZlbnQgYW4gZXJyb3IgYmVpbmcgdGhyb3duLlxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5zdWJtaXQoXG4gICAgICAgICAgICAgICAgICAgICAgICBgJHt0aGlzLm9wdGlvbnMuZ3JhcGhOYW1lfSA9IENvbmZpZ3VyZWRHcmFwaEZhY3Rvcnkub3BlbignJHt0aGlzLm9wdGlvbnMuZ3JhcGhOYW1lfScpOzA7YFxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLmNvbmZpZ1BhdGggIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5zdWJtaXQoXG4gICAgICAgICAgICAgICAgICAgICAgICBgJHt0aGlzLm9wdGlvbnMuZ3JhcGhOYW1lfSA9IEphbnVzR3JhcGhGYWN0b3J5Lm9wZW4oJyR7dGhpcy5vcHRpb25zLmNvbmZpZ1BhdGh9Jyk7MDtgXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnN1Ym1pdCh0aGlzLk9QRU5fTUdNVCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdSRUFEWSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuc3RhdGUpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnRVJST1InO1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBjcmVhdGVHcmFwaEluZGV4KGluZGV4OiBHcmFwaEluZGV4LCBjb21taXQgPSBmYWxzZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuaW5pdCgpO1xuICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IEdyYXBoSW5kZXhCdWlsZGVyKGluZGV4Lm5hbWUpO1xuICAgICAgICBidWlsZGVyLmxhYmVsKGluZGV4LmxhYmVsKS50eXBlKGluZGV4LnR5cGUpLnVuaXF1ZShpbmRleC51bmlxdWUpO1xuICAgICAgICBpbmRleC5rZXlzLmZvckVhY2goKGspID0+IGJ1aWxkZXIua2V5KGspKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnN1Ym1pdChidWlsZGVyLmJ1aWxkKCkpO1xuICAgICAgICAgICAgaWYgKGNvbW1pdCkgYXdhaXQgdGhpcy5jb21taXQoKTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoMSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBjcmVhdGVWZXJ0ZXhDZW50cmljSW5kZXgoXG4gICAgICAgIGluZGV4OiBWZXJ0ZXhDZW50cmljSW5kZXgsXG4gICAgICAgIGNvbW1pdCA9IGZhbHNlXG4gICAgKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBWZXJ0ZXhDZW50cmljSW5kZXhCdWlsZGVyKGluZGV4Lm5hbWUpO1xuICAgICAgICBidWlsZGVyXG4gICAgICAgICAgICAuZGlyZWN0aW9uKGluZGV4LmRpcmVjdGlvbilcbiAgICAgICAgICAgIC5lZGdlbGFiZWwoaW5kZXguZWRnZWxhYmVsKVxuICAgICAgICAgICAgLm9yZGVyKGluZGV4Lm9yZGVyKTtcbiAgICAgICAgaW5kZXgua2V5cy5mb3JFYWNoKChrKSA9PiBidWlsZGVyLmtleShrKSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXQoKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnN1Ym1pdChidWlsZGVyLmJ1aWxkKCkpO1xuICAgICAgICAgICAgaWYgKGNvbW1pdCkgYXdhaXQgdGhpcy5jb21taXQoKTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoMSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyB3YWl0Rm9ySW5kaWNlcyhzY2hlbWE6IEdyYXBoU2NoZW1hLCBncmFwaD86IHN0cmluZyk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXQoKTtcbiAgICAgICAgICAgIHJldHVybiAoYXdhaXQgUHJvbWlzZS5hbGwoWy4uLnNjaGVtYS5ncmFwaEluZGljZXMsIC4uLnNjaGVtYS52Y0luZGljZXNdLm1hcCgoaSkgPT4gdGhpcy53YWl0Rm9ySW5kZXgoaSwgZ3JhcGgpKSkpLmxlbmd0aDtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHdhaXRGb3JJbmRleChpbmRleDogR3JhcGhJbmRleCB8IFZlcnRleENlbnRyaWNJbmRleCwgZ3JhcGg/OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IFdhaXRGb3JJbmRleEJ1aWxkZXIoaW5kZXgubmFtZSwgZ3JhcGgpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5pbml0KCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNsaWVudC5zdWJtaXQoYnVpbGRlci5idWlsZCgpKTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoMSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXaWxsIGJ1aWxkIG9ubHkgdGhlIGluZGljZXMgZnJvbSBhIGdyYXBoIHNjaGVtYS5cbiAgICAgKiBAcGFyYW0gc2NoZW1hIC0gR3JhcGhTY2hlbWEgdG8gZ2V0IGluZGV4IGRlZmluaXRpb25zIGZyb20uXG4gICAgICogQHBhcmFtIGNvbW1pdCAtIFdoZXRoZXIgb3Igbm90IHRvIGNvbW1pdCBhbmQgY2xvc2UgdGhlIHRyYXZlcnNhbC4gRGVmYXVsdDogYGZhbHNlYFxuICAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSBjb250YWluaW5nIHRoZSBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCB0cmF2ZXJzYWxzIG1hZGUuXG4gICAgICovXG4gICAgYXN5bmMgY3JlYXRlSW5kaWNlcyhzY2hlbWE6IEdyYXBoU2NoZW1hLCBjb21taXQgPSBmYWxzZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXQoKTtcbiAgICAgICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgICAgICAvLyBHZW5lcmF0ZSBncmFwaCBpbmRpY2VzLlxuICAgICAgICAgICAgY291bnQgKz0gKFxuICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgICAgICAgICAgICBzY2hlbWEuZ3JhcGhJbmRpY2VzLm1hcCgoaSkgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlR3JhcGhJbmRleChpLCBjb21taXQpXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApLmxlbmd0aDtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIHZjIGluZGljZXMuXG4gICAgICAgICAgICBjb3VudCArPSAoXG4gICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtYS52Y0luZGljZXMubWFwKChpKSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVWZXJ0ZXhDZW50cmljSW5kZXgoaSwgY29tbWl0KVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKS5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoY29tbWl0KSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21taXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY291bnQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXR0ZW1wdHMgdG8gZW5hYmxlIGluZGljZXMuXG4gICAgICogQHBhcmFtIHNjaGVtYSAtIEdyYXBoU2NoZW1hIHRvIGVuYWJsZSBpbmRpY2llcyBmb3IuXG4gICAgICogQHBhcmFtIGNvbW1pdCAtIFdoZXRoZXIgb3Igbm90IHRvIGNvbW1pdCBhbmQgY2xvc2UgdGhlIHRyYXZlcnNhbC4gRGVmYXVsdDogYGZhbHNlYFxuICAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSBjb250YWluaW5nIHRoZSBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCB0cmF2ZXJzYWxzIG1hZGUuXG4gICAgICovXG4gICAgYXN5bmMgZW5hYmxlSW5kaWNlcyhzY2hlbWE6IEdyYXBoU2NoZW1hLCBjb21taXQgPSBmYWxzZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXQoKTtcbiAgICAgICAgICAgIGNvbnN0IGdpID0gc2NoZW1hLmdyYXBoSW5kaWNlcy5tYXAoKGkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IEVuYWJsZUluZGV4QnVpbGRlcihpLm5hbWUsIHNjaGVtYS5uYW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRlci5hY3Rpb24oXCJSRUlOREVYXCIpLmJ1aWxkKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHZjaSA9IHNjaGVtYS52Y0luZGljZXMubWFwKChpKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBFbmFibGVJbmRleEJ1aWxkZXIoaS5uYW1lLCBzY2hlbWEubmFtZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIudHlwZSgnVmVydGV4Q2VudHJpYycpLmxhYmVsKGkuZWRnZWxhYmVsKS5idWlsZCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBjb3VudCA9IChcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICAgICAgICAgICAgWy4uLmdpLCAuLi52Y2ldLm1hcCgobXNnKSA9PiB0aGlzLmNsaWVudC5zdWJtaXQobXNnKSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApLmxlbmd0aDtcbiAgICAgICAgICAgIGlmIChjb21taXQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNvbW1pdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjb3VudCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFsbCB0aGUgc2NoZW1hIGRlZmluaXRpb25zLlxuICAgICAqIEBwYXJhbSBzY2hlbWEgLSBHcmFwaFNjaGVtYSB0byBnZXQgc2NoZW1hIGRlZmluaXRpb25zIGZyb20uXG4gICAgICogQHBhcmFtIGluZGljZXMgLSBJZiBzZXQgYHRydWVgLCB3aWxsIGJ1aWxkIGluZGljZXMgYXMgd2VsbC4gRGVmYXVsdCBgZmFsc2VgLlxuICAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSBjb250YWluaW5nIHRoZSBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCB0cmF2ZXJzYWxzIG1hZGUuXG4gICAgICovXG4gICAgYXN5bmMgY3JlYXRlU2NoZW1hKHNjaGVtYTogR3JhcGhTY2hlbWEsIGluZGljZXMgPSBmYWxzZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXQoKTtcbiAgICAgICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgICAgICAvLyBFeHRyYWN0L0J1aWxkIG91ciBwcm9wZXJ0aWVzIGRlZmluaXRpb25zLlxuICAgICAgICAgICAgY291bnQgKz0gKFxuICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgICAgICAgICAgICBbLi4uc2NoZW1hLnZlcnRpY2VzLCAuLi5zY2hlbWEuZWRnZXNdXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmxhdE1hcCgodikgPT4gdi5wcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgocCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgUHJvcGVydHlCdWlsZGVyKHAua2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YXR5cGUocC5kYXRhdHlwZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhcmRpbmFsaXR5KHAuY2FyZGluYWxpdHkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5idWlsZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKG1zZykgPT4gdGhpcy5jbGllbnQuc3VibWl0KG1zZykpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKS5sZW5ndGg7XG4gICAgICAgICAgICAvLyBDcmVhdGUgbGFiZWxzIGFuZCBhc3NvY2lhdGUgcHJvcGVydGllcyBmb3IgdmVydGljZXMuXG4gICAgICAgICAgICBjb3VudCArPSAoXG4gICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtYS52ZXJ0aWNlc1xuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgodikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgVmVydGV4QnVpbGRlcih2LmxhYmVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LnByb3BlcnRpZXMuZm9yRWFjaCgocCkgPT4gYnVpbGRlci5wcm9wZXJ0eShwKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKChtc2cpID0+IHRoaXMuY2xpZW50LnN1Ym1pdChtc2cpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkubGVuZ3RoO1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGxhYmVscyBhbmQgYXNzb2NpYXRlIHByb3BlcnRpZXMgZm9yIGVkZ2VzLlxuICAgICAgICAgICAgY291bnQgKz0gKFxuICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgICAgICAgICAgICBzY2hlbWEuZWRnZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IEVkZ2VCdWlsZGVyKGUubGFiZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJvcGVydGllcy5mb3JFYWNoKChwKSA9PiBidWlsZGVyLnByb3BlcnR5KHApKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKG1zZykgPT4gdGhpcy5jbGllbnQuc3VibWl0KG1zZykpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKS5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoaW5kaWNlcykge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY29tbWl0KCk7XG4gICAgICAgICAgICAgICAgY291bnQgKz0gYXdhaXQgdGhpcy5jcmVhdGVJbmRpY2VzKHNjaGVtYSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNvdW50KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldEluZGljZXMoKTogUHJvbWlzZTxPYmplY3RbXT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5pbml0KCk7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gKGF3YWl0IHRoaXMuY2xpZW50LnN1Ym1pdCgnbWdtdC5nZXRHcmFwaEluZGV4ZXMoVmVydGV4LmNsYXNzKScpKTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZGF0YS5faXRlbXMpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTGV2ZXJhZ2VzIHRoZSBncmVtbGluIGNsaWVudCB0byBjb21taXQgYSBtYW5hZ2VtZW50IG1lc3NhZ2UuXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgTWVzc2FnZSB0byBzZW5kIHByaW9yIHRvIHRoZSBjb21taXQuIE5vdCByZXF1aXJlZC5cbiAgICAgKiBAcmV0dXJucyBBIHByb21pc2UgZnJvbSBjbGllbnQgY29tbWl0IHN1Ym1pc3Npb24uXG4gICAgICovXG4gICAgYXN5bmMgY29tbWl0KG1lc3NhZ2U/OiBzdHJpbmcpOiBQcm9taXNlPHVua25vd24+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuaW5pdCgpO1xuICAgICAgICAgICAgY29uc3QgY29tbWl0ID0gYXdhaXQgdGhpcy5jbGllbnQuc3VibWl0KFxuICAgICAgICAgICAgICAgIGAke21lc3NhZ2UgPz8gJyd9O21nbXQuY29tbWl0KCk7YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnQ09NTUlUJztcbiAgICAgICAgICAgIHJldHVybiBjb21taXQ7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdFUlJPUic7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEF0dGVtcHRzIHRvIGNsb3NlIHRoZSBncmVtbGluIGNsaWVudC5cbiAgICAgKiBAcmV0dXJucyBBIHByb21pc2Ugd2l0aCBjbG9zZSBzdGF0dXMtLSBkZWZlcnMgdG8ge0BzZWUgZHJpdmVyLkNsaWVudC5wcm90b3R5cGUuY2xvc2UoKX1cbiAgICAgKi9cbiAgICBhc3luYyBjbG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChbJ0NMT1NFRCcsICdFUlJPUiddLnNvbWUoKHMpID0+IHMgPT09IHRoaXMuc3RhdGUpKSByZXR1cm47XG4gICAgICAgICAgICBjb25zdCBjbG9zZSA9IGF3YWl0IHRoaXMuY2xpZW50LmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gJ0NMT1NFRCc7XG4gICAgICAgICAgICByZXR1cm4gY2xvc2U7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdFUlJPUic7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=