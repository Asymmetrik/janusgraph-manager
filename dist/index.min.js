(()=>{"use strict";var e={389:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeBuilder=void 0,t.EdgeBuilder=class{constructor(e){this._label=e,this._multiplicity="MULTI",this._properties=[]}multiplicity(e){return this._multiplicity=e,this}property(e){return this._properties.some((t=>t.key===e.key))||this._properties.push(e),this}build(){let e=`if (!mgmt.containsEdgeLabel('${this._label}')) `;return e+=`mgmt.makeEdgeLabel('${this._label}')`,e+=null!=this._multiplicity?`.multiplicity(${this._multiplicity})`:"",e+=".make();",this._properties.length>0&&(e+="mgmt.addProperties(",e+=`mgmt.getEdgeLabel('${this._label}'), `,e+=[...this._properties].map((e=>`mgmt.getPropertyKey('${e.key}')`)).join(", "),e+=")"),e}}},480:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EnableIndexBuilder=void 0,t.EnableIndexBuilder=class{constructor(e,t="graph"){this._name=e,this._graph=t}type(e){return this._type=e,this}label(e){return"VertexCentric"!==this._type&&console.warn(`Label ${e} set on EnableIndex builder. This only applies for VertexCentric indices.`),this._label=e,this}build(){let e="mgmt.updateIndex(";if("VertexCentric"===this._type){if(null==this._label||""===this._label)throw Error(`Vertex Centric index '${this._name}' attempted to be enabled without a label definition.`);e+=`mgmt.getRelationIndex(${this._graph}, '${this._name}', '${this._label}')`}else e+=`mgmt.getGraphIndex('${this._name}')`;return e+=", SchemaAction.ENABLE_INDEX);",e}}},32:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphIndexBuilder=void 0,t.GraphIndexBuilder=class{constructor(e){this._name=e,this._keys=[]}type(e){return this._type=e,this}key(e){return this._keys.some((t=>t.field===e.field))||this._keys.push(e),this}unique(e=!1){return this._unique=e,this}label(e){return this._label=e,this}build(){if(0===this._keys.length)throw Error(`Unable to generate index ${this._name} with no key definitions.`);let e=`if (!mgmt.containsGraphIndex('${this._name}')) `;return e+=`mgmt.buildIndex('${this._name}', Vertex.class)`,e+=[...this._keys].map((e=>`.addKey(mgmt.getPropertyKey('${e.field}')${"Mixed"===this._type?`Mapping.${e.mapping}.asParameter()`:""})`)).join(""),e+=this._unique?".unique()":"",e+=null!=this._label?`.indexOnly(mgmt.getVertexLabel('${this._label}'))`:"",e.concat("Mixed"===this._type?'.buildMixedIndex("search");':".buildCompositeIndex();")}}},638:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyBuilder=void 0,t.PropertyBuilder=class{constructor(e){this._key=e,this._cardinality="SINGLE"}cardinality(e){return this._cardinality=e,this}datatype(e){return this._datatype=e,this}build(){let e=`if (!mgmt.containsPropertyKey('${this._key}')) `;return e+=`mgmt.makePropertyKey('${this._key}')`,e+=null!=this._datatype?`.dataType(${this._datatype}.class)`:"",e+=null!=this._cardinality?`.cardinality(Cardinality.${this._cardinality})`:"",e.concat(".make();")}}},513:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VertexBuilder=void 0,t.VertexBuilder=class{constructor(e){this._label=e,this._properties=[]}property(e){return this._properties.some((t=>t.key===e.key))||this._properties.push(e),this}build(){let e=`if (!mgmt.containsVertexLabel('${this._label}')) `;return e+=`mgmt.makeVertexLabel('${this._label}')`,e+=".make();",this._properties.length>0&&(e+="mgmt.addProperties(",e+=`mgmt.getVertexLabel('${this._label}'), `,e+=[...this._properties].map((e=>`mgmt.getPropertyKey('${e.key}')`)).join(", "),e+=")"),e}}},779:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VertexCentricIndexBuilder=void 0,t.VertexCentricIndexBuilder=class{constructor(e){this._name=e,this._keys=new Set,this._order="asc"}edgelabel(e){return this._edgelabel=e,this}direction(e){return this._direction=e,this}order(e){return this._order=e,this}key(e){return this._keys.add(e),this}build(){if(0===this._keys.size)throw Error(`Unable to generate vc index ${this._name} with no key definitions.`);if(null==this._direction)throw Error(`Unable to generate vc index ${this._name} with no directionality.`);if(null==this._edgelabel||""===this._edgelabel)throw Error(`Unable to generate vc index ${this._name} with no edge label.`);let e=`if (!mgmt.containsGraphIndex('${this._name}')) `;return e+="mgmt.buildEdgeIndex(",e+=`mgmt.getEdgeLabel('${this._edgelabel}'), `,e+=`'${this._name}', `,e+=`Direction.${this._direction}, `,e+=`Order.${this._order}, `,e+=[...this._keys].map((e=>`mgmt.getPropertyKey('${e}')`)).join(", "),e.concat(");")}}},463:function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),a=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),a(i(389),t),a(i(480),t),a(i(32),t),a(i(638),t),a(i(513),t),a(i(779),t)}},t={};function i(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.JanusGraphManager=void 0;const t=i(463);e.JanusGraphManager=class{constructor(e,t){this.client=e,this.options=t,this.state="NEW",this.OPEN_MGMT=`mgmt = ${this.options.graphName}.openManagement();0;`,null==t.graphName&&(this.options.graphName="graph"),null==t.useConfiguredGraphFactory&&(this.options.useConfiguredGraphFactory=!1)}async init(){try{return"READY"!==this.state&&(this.options.useConfiguredGraphFactory?await this.client.submit(`${this.options.graphName} = ConfiguredGraphFactory.open('${this.options.graphName}');0;`):null!=this.options.configPath&&await this.client.submit(`${this.options.graphName} = JanusGraphFactory.open('${this.options.configPath}');0;`),await this.client.submit(this.OPEN_MGMT),this.state="READY"),Promise.resolve(this.state)}catch(e){return this.state="ERROR",Promise.reject(e)}}async createGraphIndex(e,i=!1){await this.init();const r=new t.GraphIndexBuilder(e.name);r.label(e.label).type(e.type).unique(e.unique),e.keys.forEach((e=>r.key(e)));try{return await this.client.submit(r.build()),i&&await this.commit(),Promise.resolve(1)}catch(e){return Promise.reject(e)}}async createVertexCentricIndex(e,i=!1){await this.init();const r=new t.VertexCentricIndexBuilder(e.name);r.direction(e.direction).edgelabel(e.edgelabel).order(e.order),e.keys.forEach((e=>r.key(e)));try{return await this.client.submit(r.build()),i&&await this.commit(),Promise.resolve(1)}catch(e){return Promise.reject(e)}}async createIndices(e,t=!1){try{await this.init();let i=0;return i+=(await Promise.all(e.graphIndices.map((e=>this.createGraphIndex(e,t))))).length,i+=(await Promise.all(e.vcIndices.map((e=>this.createVertexCentricIndex(e,t))))).length,t&&await this.commit(),Promise.resolve(i)}catch(e){return Promise.reject(e)}}async enableIndices(e,i=!1){try{await this.init();const r=e.graphIndices.map((i=>new t.EnableIndexBuilder(i.name,e.name).build())),a=e.vcIndices.map((i=>new t.EnableIndexBuilder(i.name,e.name).type("VertexCentric").label(i.edgelabel).build())),s=[...r,...a].map((e=>this.client.submit(e))).length;return i&&await this.commit(),Promise.resolve(s)}catch(e){return Promise.reject(e)}}async createSchema(e,i=!1){try{await this.init();let r=0;return r+=(await Promise.all([...e.vertices,...e.edges].flatMap((e=>e.properties)).map((e=>new t.PropertyBuilder(e.key).datatype(e.datatype).cardinality(e.cardinality).build())).map((e=>this.client.submit(e))))).length,r+=(await Promise.all(e.vertices.map((e=>{const i=new t.VertexBuilder(e.label);return e.properties.forEach((e=>i.property(e))),i.build()})).map((e=>this.client.submit(e))))).length,r+=(await Promise.all(e.edges.map((e=>{const i=new t.EdgeBuilder(e.label);return e.properties.forEach((e=>i.property(e))),i.build()})).map((e=>this.client.submit(e))))).length,i&&(await this.commit(),r+=await this.createIndices(e)),Promise.resolve(r)}catch(e){return Promise.reject(e)}}async commit(e){try{await this.init();const t=await this.client.submit(`${e??""};mgmt.commit();`);return this.state="COMMIT",t}catch(e){return this.state="ERROR",Promise.reject(e)}}async close(){try{if(["CLOSED","ERROR"].some((e=>e===this.state)))return;const e=await this.client.close();return this.state="CLOSED",e}catch(e){return this.state="ERROR",Promise.reject(e)}}}})(),exports.janusgraphmanager=r})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qYW51c2dyYXBobWFuYWdlci8uL3NyYy9idWlsZGVycy9FZGdlQnVpbGRlci50cyIsIndlYnBhY2s6Ly9qYW51c2dyYXBobWFuYWdlci8uL3NyYy9idWlsZGVycy9FbmFibGVJbmRleEJ1aWxkZXIudHMiLCJ3ZWJwYWNrOi8vamFudXNncmFwaG1hbmFnZXIvLi9zcmMvYnVpbGRlcnMvR3JhcGhJbmRleEJ1aWxkZXIudHMiLCJ3ZWJwYWNrOi8vamFudXNncmFwaG1hbmFnZXIvLi9zcmMvYnVpbGRlcnMvUHJvcGVydHlCdWlsZGVyLnRzIiwid2VicGFjazovL2phbnVzZ3JhcGhtYW5hZ2VyLy4vc3JjL2J1aWxkZXJzL1ZlcnRleEJ1aWxkZXIudHMiLCJ3ZWJwYWNrOi8vamFudXNncmFwaG1hbmFnZXIvLi9zcmMvYnVpbGRlcnMvVmVydGV4Q2VudHJpY0luZGV4QnVpbGRlci50cyIsIndlYnBhY2s6Ly9qYW51c2dyYXBobWFuYWdlci8uL3NyYy9idWlsZGVycy9pbmRleC50cyIsIndlYnBhY2s6Ly9qYW51c2dyYXBobWFuYWdlci93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9qYW51c2dyYXBobWFuYWdlci8uL3NyYy9KYW51c0dyYXBoTWFuYWdlci50cyJdLCJuYW1lcyI6WyJfbGFiZWwiLCJfbXVsdGlwbGljaXR5IiwiX3Byb3BlcnRpZXMiLCJtdWx0aXBsaWNpdHkiLCJ0aGlzIiwicHJvcGVydHkiLCJzb21lIiwicCIsImtleSIsInB1c2giLCJvdXRwdXQiLCJsZW5ndGgiLCJtYXAiLCJwcm9wIiwiam9pbiIsIl9uYW1lIiwiX2dyYXBoIiwidHlwZSIsIl90eXBlIiwibGFiZWwiLCJjb25zb2xlIiwid2FybiIsIkVycm9yIiwiX2tleXMiLCJrIiwiZmllbGQiLCJ1bmlxdWUiLCJfdW5pcXVlIiwibWFwcGluZyIsImNvbmNhdCIsIl9rZXkiLCJfY2FyZGluYWxpdHkiLCJjYXJkaW5hbGl0eSIsImRhdGF0eXBlIiwiX2RhdGF0eXBlIiwiU2V0IiwiX29yZGVyIiwiZWRnZWxhYmVsIiwiX2VkZ2VsYWJlbCIsImRpcmVjdGlvbiIsIl9kaXJlY3Rpb24iLCJvcmRlciIsImFkZCIsInNpemUiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImNhbGwiLCJjbGllbnQiLCJvcHRpb25zIiwic3RhdGUiLCJPUEVOX01HTVQiLCJncmFwaE5hbWUiLCJ1c2VDb25maWd1cmVkR3JhcGhGYWN0b3J5Iiwic3VibWl0IiwiY29uZmlnUGF0aCIsIlByb21pc2UiLCJyZXNvbHZlIiwiZXJyIiwicmVqZWN0IiwiaW5kZXgiLCJjb21taXQiLCJpbml0IiwiYnVpbGRlciIsIkdyYXBoSW5kZXhCdWlsZGVyIiwibmFtZSIsImtleXMiLCJmb3JFYWNoIiwiYnVpbGQiLCJWZXJ0ZXhDZW50cmljSW5kZXhCdWlsZGVyIiwic2NoZW1hIiwiY291bnQiLCJhbGwiLCJncmFwaEluZGljZXMiLCJpIiwiY3JlYXRlR3JhcGhJbmRleCIsInZjSW5kaWNlcyIsImNyZWF0ZVZlcnRleENlbnRyaWNJbmRleCIsImdpIiwiRW5hYmxlSW5kZXhCdWlsZGVyIiwidmNpIiwibXNnIiwiaW5kaWNlcyIsInZlcnRpY2VzIiwiZWRnZXMiLCJmbGF0TWFwIiwidiIsInByb3BlcnRpZXMiLCJQcm9wZXJ0eUJ1aWxkZXIiLCJWZXJ0ZXhCdWlsZGVyIiwiZSIsIkVkZ2VCdWlsZGVyIiwiY3JlYXRlSW5kaWNlcyIsIm1lc3NhZ2UiLCJzIiwiY2xvc2UiXSwibWFwcGluZ3MiOiI0R0FJQSxvQkFJSSxZQUFvQkEsR0FBQSxLQUFBQSxTQUhaLEtBQUFDLGNBQWtDLFFBQ2xDLEtBQUFDLFlBQTBCLEdBSWxDLGFBQWFDLEdBRVQsT0FEQUMsS0FBS0gsY0FBZ0JFLEVBQ2RDLEtBR1gsU0FBU0MsR0FDTCxPQUFJRCxL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SyxXQUVsQjdELEtBQUswRSxHQUFRbEYsS0FBS2lELE9BQU9NLE9BQU8yQixPQUUzQzNFLE9BRUZpRSxVQUNVZixRQUFRZ0IsSUFDVkYsRUFBT2MsTUFDRjdFLEtBQUttRixJQUNGLE1BQU0zQixFQUFVLElBQUksRUFBQTRCLFlBQVlELEVBQUU1RSxPQUVsQyxPQURBNEUsRUFBRUgsV0FBV3BCLFNBQVNqRSxHQUFNNkQsRUFBUS9ELFNBQVNFLEtBQ3RDNkQsRUFBUUssV0FFbEI3RCxLQUFLMEUsR0FBUWxGLEtBQUtpRCxPQUFPTSxPQUFPMkIsT0FFM0MzRSxPQUNFNEUsVUFDTW5GLEtBQUs4RCxTQUNYVSxTQUFleEUsS0FBSzZGLGNBQWN0QixJQUUvQmQsUUFBUUMsUUFBUWMsR0FDekIsTUFBT2IsR0FDTCxPQUFPRixRQUFRRyxPQUFPRCxJQVM5QixhQUFhbUMsR0FDVCxVQUNVOUYsS0FBSytELE9BQ1gsTUFBTUQsUUFBZTlELEtBQUtpRCxPQUFPTSxPQUM3QixHQUFHdUMsR0FBVyxxQkFHbEIsT0FEQTlGLEtBQUttRCxNQUFRLFNBQ05XLEVBQ1QsTUFBT0gsR0FFTCxPQURBM0QsS0FBS21ELE1BQVEsUUFDTk0sUUFBUUcsT0FBT0QsSUFROUIsY0FDSSxJQUNJLEdBQUksQ0FBQyxTQUFVLFNBQVN6RCxNQUFNNkYsR0FBTUEsSUFBTS9GLEtBQUttRCxRQUFRLE9BQ3ZELE1BQU02QyxRQUFjaEcsS0FBS2lELE9BQU8rQyxRQUVoQyxPQURBaEcsS0FBS21ELE1BQVEsU0FDTjZDLEVBQ1QsTUFBT3JDLEdBRUwsT0FEQTNELEtBQUttRCxNQUFRLFFBQ05NLFFBQVFHLE9BQU9ELE8iLCJmaWxlIjoiaW5kZXgubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQnVpbGRlciB9IGZyb20gXCIuL0J1aWxkZXIuaW50ZXJmYWNlXCI7XG5pbXBvcnQgeyBFZGdlTXVsdGlwbGljaXR5IH0gZnJvbSBcIi4uL3R5cGVzL0VkZ2VcIjtcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSBcIi4uL3R5cGVzL1Byb3BlcnR5XCI7XG5cbmV4cG9ydCBjbGFzcyBFZGdlQnVpbGRlciBpbXBsZW1lbnRzIEJ1aWxkZXI8c3RyaW5nPiB7XG4gICAgcHJpdmF0ZSBfbXVsdGlwbGljaXR5OiBFZGdlTXVsdGlwbGljaXR5ID0gXCJNVUxUSVwiO1xuICAgIHByaXZhdGUgX3Byb3BlcnRpZXM6IFByb3BlcnR5W10gPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX2xhYmVsOiBzdHJpbmcpIHt9XG5cbiAgICBtdWx0aXBsaWNpdHkobXVsdGlwbGljaXR5OiBFZGdlTXVsdGlwbGljaXR5KTogdGhpcyB7XG4gICAgICAgIHRoaXMuX211bHRpcGxpY2l0eSA9IG11bHRpcGxpY2l0eTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgcHJvcGVydHkocHJvcGVydHk6IFByb3BlcnR5KTogdGhpcyB7XG4gICAgICAgIGlmICh0aGlzLl9wcm9wZXJ0aWVzLnNvbWUoKHApID0+IHAua2V5ID09PSBwcm9wZXJ0eS5rZXkpKSByZXR1cm4gdGhpcztcbiAgICAgICAgdGhpcy5fcHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgYnVpbGQoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG91dHB1dCA9IGBpZiAoIW1nbXQuY29udGFpbnNFZGdlTGFiZWwoJyR7dGhpcy5fbGFiZWx9JykpIGA7XG4gICAgICAgIG91dHB1dCArPSBgbWdtdC5tYWtlRWRnZUxhYmVsKCcke3RoaXMuX2xhYmVsfScpYDtcbiAgICAgICAgb3V0cHV0ICs9XG4gICAgICAgICAgICB0aGlzLl9tdWx0aXBsaWNpdHkgIT0gbnVsbFxuICAgICAgICAgICAgICAgID8gYC5tdWx0aXBsaWNpdHkoJHt0aGlzLl9tdWx0aXBsaWNpdHl9KWBcbiAgICAgICAgICAgICAgICA6IFwiXCI7XG4gICAgICAgIG91dHB1dCArPSBcIi5tYWtlKCk7XCI7XG4gICAgICAgIGlmICh0aGlzLl9wcm9wZXJ0aWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG91dHB1dCArPSBcIm1nbXQuYWRkUHJvcGVydGllcyhcIjtcbiAgICAgICAgICAgIG91dHB1dCArPSBgbWdtdC5nZXRFZGdlTGFiZWwoJyR7dGhpcy5fbGFiZWx9JyksIGA7XG4gICAgICAgICAgICBvdXRwdXQgKz0gWy4uLnRoaXMuX3Byb3BlcnRpZXNdXG4gICAgICAgICAgICAgICAgLm1hcCgocHJvcCkgPT4gYG1nbXQuZ2V0UHJvcGVydHlLZXkoJyR7cHJvcC5rZXl9JylgKVxuICAgICAgICAgICAgICAgIC5qb2luKFwiLCBcIik7XG4gICAgICAgICAgICBvdXRwdXQgKz0gXCIpXCI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBJbmRleFR5cGUgfSBmcm9tICcuLi90eXBlcy9HcmFwaEluZGV4JztcbmltcG9ydCB7IEJ1aWxkZXIgfSBmcm9tICcuL0J1aWxkZXIuaW50ZXJmYWNlJztcblxuLyoqXG4gKiBCdWlsZHMgYSBtYW5hZ2VtZW50IHN0cmluZyB0aGF0IGF0dGVtcHRzIHRvIGVuYWJsZSBhIHNwZWNpZmljIGluZGV4LlxuICovXG5leHBvcnQgY2xhc3MgRW5hYmxlSW5kZXhCdWlsZGVyIGltcGxlbWVudHMgQnVpbGRlcjxzdHJpbmc+IHtcbiAgICBwcml2YXRlIF90eXBlITogSW5kZXhUeXBlO1xuICAgIHByaXZhdGUgX2xhYmVsITogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci5cbiAgICAgKiBAcGFyYW0gX25hbWUgSW5kZXggdG8gYXR0ZW1wdCB0byBlbmFibGUuXG4gICAgICogQHBhcmFtIF9ncmFwaCBHcmFwaCBuYW1lIHRoYXQgdGhlIGluZGV4IHJlc2lkZXMgb24uIERlZmF1bHQgYGdyYXBoYC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9uYW1lOiBzdHJpbmcsIHByaXZhdGUgX2dyYXBoOiBzdHJpbmcgPSAnZ3JhcGgnKSB7fVxuXG4gICAgdHlwZSh0eXBlOiBJbmRleFR5cGUpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5fdHlwZSA9IHR5cGU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHZlcnRleCBsYWJlbCBmb3IgVmVydGV4Q2VudHJpYyBpbmRpY2llcy5cbiAgICAgKiBAcGFyYW0gbGFiZWwgTGFiZWxcbiAgICAgKiBAcmV0dXJucyBUaGUgYnVpbGRlci5cbiAgICAgKi9cbiAgICBsYWJlbChsYWJlbDogc3RyaW5nKTogdGhpcyB7XG4gICAgICAgIGlmICh0aGlzLl90eXBlICE9PSAnVmVydGV4Q2VudHJpYycpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICAgICBgTGFiZWwgJHtsYWJlbH0gc2V0IG9uIEVuYWJsZUluZGV4IGJ1aWxkZXIuIFRoaXMgb25seSBhcHBsaWVzIGZvciBWZXJ0ZXhDZW50cmljIGluZGljZXMuYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9sYWJlbCA9IGxhYmVsO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZHMgdGhlIG91dHB1dCBzdHJpbmcuXG4gICAgICogQHJldHVybnMgU3RyaW5nIHRoYXQgY2FsbHMgRU5BQkxFX0lOREVYIGluIEpHLlxuICAgICAqIEB0aHJvd3MgQW4gRXJyb3IgaWYgYW4gYXR0ZW1wdCBpcyBtYWRlIHRvIGVuYWJsZSBhIFZlcnRleENlbnRyaWMgaW5kZXggd2l0aG91dCBhIGxhYmVsLlxuICAgICAqL1xuICAgIGJ1aWxkKCk6IHN0cmluZyB7XG4gICAgICAgIGxldCBvdXRwdXQgPSAnbWdtdC51cGRhdGVJbmRleCgnO1xuICAgICAgICBpZiAodGhpcy5fdHlwZSA9PT0gJ1ZlcnRleENlbnRyaWMnKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fbGFiZWwgPT0gbnVsbCB8fCB0aGlzLl9sYWJlbCA9PT0gJycpXG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgIGBWZXJ0ZXggQ2VudHJpYyBpbmRleCAnJHt0aGlzLl9uYW1lfScgYXR0ZW1wdGVkIHRvIGJlIGVuYWJsZWQgd2l0aG91dCBhIGxhYmVsIGRlZmluaXRpb24uYFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICBvdXRwdXQgKz0gYG1nbXQuZ2V0UmVsYXRpb25JbmRleCgke3RoaXMuX2dyYXBofSwgJyR7dGhpcy5fbmFtZX0nLCAnJHt0aGlzLl9sYWJlbH0nKWA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvdXRwdXQgKz0gYG1nbXQuZ2V0R3JhcGhJbmRleCgnJHt0aGlzLl9uYW1lfScpYDtcbiAgICAgICAgfVxuICAgICAgICBvdXRwdXQgKz0gYCwgU2NoZW1hQWN0aW9uLkVOQUJMRV9JTkRFWCk7YDtcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBCdWlsZGVyIH0gZnJvbSAnLi9CdWlsZGVyLmludGVyZmFjZSc7XG5pbXBvcnQgeyBDb21wb3NpdGVPck1peGVkSW5kZXhUeXBlLCBJbmRleEtleSB9IGZyb20gJy4uL3R5cGVzL0dyYXBoSW5kZXgnO1xuXG4vKipcbiAqIEluZGV4IEJ1aWxkZXIgZm9yIENvbXBvc2l0ZSBvciBNaXhlZCBpbmRpY2VzLlxuICpcbiAqIEZvciBWZXJ0ZXhDZW50cmljIGluZGljaWVzLCBwbGVhc2UgdXNlIHtAbGluayBWZXJ0ZXhDZW50cmljSW5kZXhCdWlsZGVyfVxuICovXG5leHBvcnQgY2xhc3MgR3JhcGhJbmRleEJ1aWxkZXIgaW1wbGVtZW50cyBCdWlsZGVyPHN0cmluZz4ge1xuICAgIHByaXZhdGUgX3R5cGU/OiBDb21wb3NpdGVPck1peGVkSW5kZXhUeXBlO1xuICAgIHByaXZhdGUgX2tleXM6IEluZGV4S2V5W10gPSBbXTtcbiAgICBwcml2YXRlIF91bmlxdWU/OiBib29sZWFuO1xuICAgIHByaXZhdGUgX2xhYmVsPzogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfbmFtZTogc3RyaW5nKSB7fVxuXG4gICAgdHlwZSh0eXBlOiBDb21wb3NpdGVPck1peGVkSW5kZXhUeXBlKTogdGhpcyB7XG4gICAgICAgIHRoaXMuX3R5cGUgPSB0eXBlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBrZXkoa2V5OiBJbmRleEtleSk6IHRoaXMge1xuICAgICAgICBpZiAodGhpcy5fa2V5cy5zb21lKChrKSA9PiBrLmZpZWxkID09PSBrZXkuZmllbGQpKSByZXR1cm4gdGhpcztcbiAgICAgICAgdGhpcy5fa2V5cy5wdXNoKGtleSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHVuaXF1ZSh1bmlxdWUgPSBmYWxzZSk6IHRoaXMge1xuICAgICAgICB0aGlzLl91bmlxdWUgPSB1bmlxdWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGxhYmVsKGxhYmVsPzogc3RyaW5nKTogdGhpcyB7XG4gICAgICAgIHRoaXMuX2xhYmVsID0gbGFiZWw7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGJ1aWxkKCk6IHN0cmluZyB7XG4gICAgICAgIGlmICh0aGlzLl9rZXlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAgICAgYFVuYWJsZSB0byBnZW5lcmF0ZSBpbmRleCAke3RoaXMuX25hbWV9IHdpdGggbm8ga2V5IGRlZmluaXRpb25zLmBcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG91dHB1dCA9IGBpZiAoIW1nbXQuY29udGFpbnNHcmFwaEluZGV4KCcke3RoaXMuX25hbWV9JykpIGA7XG4gICAgICAgIG91dHB1dCArPSBgbWdtdC5idWlsZEluZGV4KCcke3RoaXMuX25hbWV9JywgVmVydGV4LmNsYXNzKWA7XG4gICAgICAgIG91dHB1dCArPSBbLi4udGhpcy5fa2V5c11cbiAgICAgICAgICAgIC5tYXAoXG4gICAgICAgICAgICAgICAgKGtleSkgPT5cbiAgICAgICAgICAgICAgICAgICAgYC5hZGRLZXkobWdtdC5nZXRQcm9wZXJ0eUtleSgnJHtrZXkuZmllbGR9Jykke1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHlwZSA9PT0gJ01peGVkJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gYE1hcHBpbmcuJHtrZXkubWFwcGluZ30uYXNQYXJhbWV0ZXIoKWBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICcnXG4gICAgICAgICAgICAgICAgICAgIH0pYFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmpvaW4oJycpO1xuICAgICAgICBvdXRwdXQgKz0gdGhpcy5fdW5pcXVlID8gYC51bmlxdWUoKWAgOiAnJztcbiAgICAgICAgb3V0cHV0ICs9XG4gICAgICAgICAgICB0aGlzLl9sYWJlbCAhPSBudWxsXG4gICAgICAgICAgICAgICAgPyBgLmluZGV4T25seShtZ210LmdldFZlcnRleExhYmVsKCcke3RoaXMuX2xhYmVsfScpKWBcbiAgICAgICAgICAgICAgICA6ICcnO1xuICAgICAgICByZXR1cm4gb3V0cHV0LmNvbmNhdChcbiAgICAgICAgICAgIHRoaXMuX3R5cGUgPT09ICdNaXhlZCdcbiAgICAgICAgICAgICAgICA/ICcuYnVpbGRNaXhlZEluZGV4KFwic2VhcmNoXCIpOydcbiAgICAgICAgICAgICAgICA6ICcuYnVpbGRDb21wb3NpdGVJbmRleCgpOydcbiAgICAgICAgKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBCdWlsZGVyIH0gZnJvbSBcIi4vQnVpbGRlci5pbnRlcmZhY2VcIjtcbmltcG9ydCB7IFByb3BlcnR5Q2FyZGluYWxpdHksIFByb3BlcnR5VHlwZSB9IGZyb20gXCIuLi90eXBlcy9Qcm9wZXJ0eVwiO1xuXG5leHBvcnQgY2xhc3MgUHJvcGVydHlCdWlsZGVyIGltcGxlbWVudHMgQnVpbGRlcjxzdHJpbmc+IHtcbiAgICBwcml2YXRlIF9kYXRhdHlwZSE6IFByb3BlcnR5VHlwZTtcbiAgICBwcml2YXRlIF9jYXJkaW5hbGl0eTogUHJvcGVydHlDYXJkaW5hbGl0eSA9IFwiU0lOR0xFXCI7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9rZXk6IHN0cmluZykge31cblxuICAgIGNhcmRpbmFsaXR5KGNhcmRpbmFsaXR5OiBQcm9wZXJ0eUNhcmRpbmFsaXR5KTogdGhpcyB7XG4gICAgICAgIHRoaXMuX2NhcmRpbmFsaXR5ID0gY2FyZGluYWxpdHk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGRhdGF0eXBlKGRhdGF0eXBlOiBQcm9wZXJ0eVR5cGUpOiB0aGlzIHtcbiAgICAgICAgdGhpcy5fZGF0YXR5cGUgPSBkYXRhdHlwZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgYnVpbGQoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG91dHB1dCA9IGBpZiAoIW1nbXQuY29udGFpbnNQcm9wZXJ0eUtleSgnJHt0aGlzLl9rZXl9JykpIGA7XG4gICAgICAgIG91dHB1dCArPSBgbWdtdC5tYWtlUHJvcGVydHlLZXkoJyR7dGhpcy5fa2V5fScpYDtcbiAgICAgICAgb3V0cHV0ICs9XG4gICAgICAgICAgICB0aGlzLl9kYXRhdHlwZSAhPSBudWxsID8gYC5kYXRhVHlwZSgke3RoaXMuX2RhdGF0eXBlfS5jbGFzcylgIDogXCJcIjtcbiAgICAgICAgb3V0cHV0ICs9XG4gICAgICAgICAgICB0aGlzLl9jYXJkaW5hbGl0eSAhPSBudWxsXG4gICAgICAgICAgICAgICAgPyBgLmNhcmRpbmFsaXR5KENhcmRpbmFsaXR5LiR7dGhpcy5fY2FyZGluYWxpdHl9KWBcbiAgICAgICAgICAgICAgICA6IFwiXCI7XG4gICAgICAgIHJldHVybiBvdXRwdXQuY29uY2F0KFwiLm1ha2UoKTtcIik7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgQnVpbGRlciB9IGZyb20gJy4vQnVpbGRlci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tICcuLi90eXBlcy9Qcm9wZXJ0eSc7XG5cbmV4cG9ydCBjbGFzcyBWZXJ0ZXhCdWlsZGVyIGltcGxlbWVudHMgQnVpbGRlcjxzdHJpbmc+IHtcbiAgICBwcml2YXRlIF9wcm9wZXJ0aWVzOiBQcm9wZXJ0eVtdID0gW107XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9sYWJlbDogc3RyaW5nKSB7fVxuXG4gICAgcHJvcGVydHkocHJvcGVydHk6IFByb3BlcnR5KTogdGhpcyB7XG4gICAgICAgIGlmICh0aGlzLl9wcm9wZXJ0aWVzLnNvbWUoKHApID0+IHAua2V5ID09PSBwcm9wZXJ0eS5rZXkpKSByZXR1cm4gdGhpcztcbiAgICAgICAgdGhpcy5fcHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgYnVpbGQoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG91dHB1dCA9IGBpZiAoIW1nbXQuY29udGFpbnNWZXJ0ZXhMYWJlbCgnJHt0aGlzLl9sYWJlbH0nKSkgYDtcbiAgICAgICAgb3V0cHV0ICs9IGBtZ210Lm1ha2VWZXJ0ZXhMYWJlbCgnJHt0aGlzLl9sYWJlbH0nKWA7XG4gICAgICAgIG91dHB1dCArPSAnLm1ha2UoKTsnO1xuICAgICAgICBpZiAodGhpcy5fcHJvcGVydGllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBvdXRwdXQgKz0gJ21nbXQuYWRkUHJvcGVydGllcygnO1xuICAgICAgICAgICAgb3V0cHV0ICs9IGBtZ210LmdldFZlcnRleExhYmVsKCcke3RoaXMuX2xhYmVsfScpLCBgO1xuICAgICAgICAgICAgb3V0cHV0ICs9IFsuLi50aGlzLl9wcm9wZXJ0aWVzXVxuICAgICAgICAgICAgICAgIC5tYXAoKHByb3ApID0+IGBtZ210LmdldFByb3BlcnR5S2V5KCcke3Byb3Aua2V5fScpYClcbiAgICAgICAgICAgICAgICAuam9pbignLCAnKTtcbiAgICAgICAgICAgIG91dHB1dCArPSAnKSc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBCdWlsZGVyIH0gZnJvbSBcIi4vQnVpbGRlci5pbnRlcmZhY2VcIjtcbmltcG9ydCB7IERpcmVjdGlvbiwgT3JkZXIgfSBmcm9tIFwiLi4vdHlwZXMvVmVydGV4Q2VudHJpY0luZGV4XCI7XG5cbi8qKlxuICogSW5kZXggQnVpbGRlciBmb3IgVmVydGV4IENlbnRyaWMgaW5kaWNlcy5cbiAqIFxuICogRm9yIE1peGVkL0NvbXBvc2l0ZSwgcGxlYXNlIHVzZSB7QGxpbmsgSW5kZXhCdWlsZGVyfVxuICovXG5leHBvcnQgY2xhc3MgVmVydGV4Q2VudHJpY0luZGV4QnVpbGRlciBpbXBsZW1lbnRzIEJ1aWxkZXI8c3RyaW5nPiB7XG4gICAgcHJpdmF0ZSBfa2V5czogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG4gICAgcHJpdmF0ZSBfZGlyZWN0aW9uITogRGlyZWN0aW9uO1xuICAgIHByaXZhdGUgX29yZGVyOiBPcmRlciA9IFwiYXNjXCI7XG4gICAgcHJpdmF0ZSBfZWRnZWxhYmVsITogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfbmFtZTogc3RyaW5nKSB7fVxuXG4gICAgZWRnZWxhYmVsKGVkZ2VsYWJlbDogc3RyaW5nKTogdGhpcyB7XG4gICAgICAgIHRoaXMuX2VkZ2VsYWJlbCA9IGVkZ2VsYWJlbDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgZGlyZWN0aW9uKGRpcmVjdGlvbjogRGlyZWN0aW9uKTogdGhpcyB7XG4gICAgICAgIHRoaXMuX2RpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgb3JkZXIob3JkZXI6IE9yZGVyKTogdGhpcyB7XG4gICAgICAgIHRoaXMuX29yZGVyID0gb3JkZXI7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGtleShrZXk6IHN0cmluZyk6IHRoaXMge1xuICAgICAgICB0aGlzLl9rZXlzLmFkZChrZXkpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBidWlsZCgpOiBzdHJpbmcge1xuICAgICAgICBpZiAodGhpcy5fa2V5cy5zaXplID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgVW5hYmxlIHRvIGdlbmVyYXRlIHZjIGluZGV4ICR7dGhpcy5fbmFtZX0gd2l0aCBubyBrZXkgZGVmaW5pdGlvbnMuYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2RpcmVjdGlvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgVW5hYmxlIHRvIGdlbmVyYXRlIHZjIGluZGV4ICR7dGhpcy5fbmFtZX0gd2l0aCBubyBkaXJlY3Rpb25hbGl0eS5gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fZWRnZWxhYmVsID09IG51bGwgfHwgdGhpcy5fZWRnZWxhYmVsID09PSAnJykge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYFVuYWJsZSB0byBnZW5lcmF0ZSB2YyBpbmRleCAke3RoaXMuX25hbWV9IHdpdGggbm8gZWRnZSBsYWJlbC5gKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgb3V0cHV0ID0gYGlmICghbWdtdC5jb250YWluc0dyYXBoSW5kZXgoJyR7dGhpcy5fbmFtZX0nKSkgYDtcbiAgICAgICAgb3V0cHV0ICs9IGBtZ210LmJ1aWxkRWRnZUluZGV4KGA7XG4gICAgICAgIG91dHB1dCArPSBgbWdtdC5nZXRFZGdlTGFiZWwoJyR7dGhpcy5fZWRnZWxhYmVsfScpLCBgO1xuICAgICAgICBvdXRwdXQgKz0gYCcke3RoaXMuX25hbWV9JywgYDtcbiAgICAgICAgb3V0cHV0ICs9IGBEaXJlY3Rpb24uJHt0aGlzLl9kaXJlY3Rpb259LCBgO1xuICAgICAgICBvdXRwdXQgKz0gYE9yZGVyLiR7dGhpcy5fb3JkZXJ9LCBgO1xuICAgICAgICBvdXRwdXQgKz0gWy4uLnRoaXMuX2tleXNdXG4gICAgICAgICAgICAubWFwKChrZXkpID0+IGBtZ210LmdldFByb3BlcnR5S2V5KCcke2tleX0nKWApXG4gICAgICAgICAgICAuam9pbihcIiwgXCIpO1xuICAgICAgICByZXR1cm4gb3V0cHV0LmNvbmNhdChcIik7XCIpO1xuICAgIH1cbn1cbiIsImV4cG9ydCAqIGZyb20gXCIuL0VkZ2VCdWlsZGVyXCI7XG5leHBvcnQgKiBmcm9tIFwiLi9FbmFibGVJbmRleEJ1aWxkZXJcIjtcbmV4cG9ydCAqIGZyb20gXCIuL0dyYXBoSW5kZXhCdWlsZGVyXCI7XG5leHBvcnQgKiBmcm9tIFwiLi9Qcm9wZXJ0eUJ1aWxkZXJcIjtcbmV4cG9ydCAqIGZyb20gXCIuL1ZlcnRleEJ1aWxkZXJcIjtcbmV4cG9ydCAqIGZyb20gXCIuL1ZlcnRleENlbnRyaWNJbmRleEJ1aWxkZXJcIjsiLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiaW1wb3J0IHsgZHJpdmVyIH0gZnJvbSAnZ3JlbWxpbic7XG5pbXBvcnQgeyBHcmFwaFNjaGVtYSB9IGZyb20gJy4vdHlwZXMvR3JhcGhTY2hlbWEnO1xuaW1wb3J0IHtcbiAgICBFZGdlQnVpbGRlcixcbiAgICBFbmFibGVJbmRleEJ1aWxkZXIsXG4gICAgR3JhcGhJbmRleEJ1aWxkZXIsXG4gICAgUHJvcGVydHlCdWlsZGVyLFxuICAgIFZlcnRleEJ1aWxkZXIsXG4gICAgVmVydGV4Q2VudHJpY0luZGV4QnVpbGRlcixcbn0gZnJvbSAnLi9idWlsZGVycyc7XG5pbXBvcnQgeyBHcmFwaEluZGV4IH0gZnJvbSAnLi90eXBlcy9HcmFwaEluZGV4JztcbmltcG9ydCB7IFZlcnRleENlbnRyaWNJbmRleCB9IGZyb20gJy4vdHlwZXMvVmVydGV4Q2VudHJpY0luZGV4JztcblxudHlwZSBNYW5hZ2VyU3RhdGUgPSAnTkVXJyB8ICdSRUFEWScgfCAnQ09NTUlUJyB8ICdFUlJPUicgfCAnQ0xPU0VEJztcblxuZXhwb3J0IHR5cGUgSmFudXNHcmFwaE1hbmdlck9wdGlvbnMgPSB7XG4gICAgLyoqXG4gICAgICogTmFtZSBvZiB0aGUgZ3JhcGggdG8gdHJhdmVyc2UuXG4gICAgICovXG4gICAgZ3JhcGhOYW1lPzogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgb3Igbm90IHRvIHVzZSB0aGUgQ29uZmlndXJlZEdyYXBoRmFjdG9yeSBmb3IgZHluYW1pYyBncmFwaHMuXG4gICAgICovXG4gICAgdXNlQ29uZmlndXJlZEdyYXBoRmFjdG9yeT86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogUGF0aCB0byBhIEphbnVzR3JhcGhGYWN0b3J5IGNvbmZpZ3VyYXRpb24gb24gdGhlIHJlbW90ZSwgZm9yIHVzZSB3aXRoIEphbnVzR3JhcGhGYWN0b3J5LlxuICAgICAqL1xuICAgIGNvbmZpZ1BhdGg/OiBzdHJpbmc7XG59O1xuXG5leHBvcnQgY2xhc3MgSmFudXNHcmFwaE1hbmFnZXIge1xuICAgIHByaXZhdGUgc3RhdGU6IE1hbmFnZXJTdGF0ZSA9ICdORVcnO1xuXG4gICAgcHJpdmF0ZSBPUEVOX01HTVQgPSBgbWdtdCA9ICR7dGhpcy5vcHRpb25zLmdyYXBoTmFtZX0ub3Blbk1hbmFnZW1lbnQoKTswO2A7XG5cbiAgICAvKipcbiAgICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yLlxuICAgICAqIEBwYXJhbSBjbGllbnQgQSBwcmVjb25maWd1cmVkIGdyZW1saW4gY2xpZW50IGZvciBhY2Nlc3NpbmcgZ3JlbWxpbi1zZXJ2ZXIuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgSmFudXNHcmFwaE9wdGlvbnMgZm9yIGFjY2Vzc2luZyB0aGUgZ3JhcGg6XG4gICAgICogLSBncmFwaE5hbWUgd2lsbCBoYXZlIGEgZGVmYXVsdCBvZiBgJ2dyYXBoJ2AuXG4gICAgICogLSB1c2VDb25maWd1cmVkR3JhcGhGYWN0b3J5IHdpbGwgaGF2ZSBhIGRlZmF1bHQgb2YgYGZhbHNlYFxuICAgICAqIC0gY29uZmlnUGF0aCBoYXMgbm8gZGVmYXVsdC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBjbGllbnQ6IGRyaXZlci5DbGllbnQsXG4gICAgICAgIHByaXZhdGUgb3B0aW9uczogSmFudXNHcmFwaE1hbmdlck9wdGlvbnNcbiAgICApIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuZ3JhcGhOYW1lID09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5ncmFwaE5hbWUgPSAnZ3JhcGgnO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnVzZUNvbmZpZ3VyZWRHcmFwaEZhY3RvcnkgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnVzZUNvbmZpZ3VyZWRHcmFwaEZhY3RvcnkgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZW5zIHRoZSBtYW5hZ2VtZW50IHN5c3RlbSBmb3IgdGhlIGNsaWVudCBzZXNzaW9uLlxuICAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSB3aXRoIHRoZSBzdGF0ZSBvZiB0aGUgbWFuYWdlci5cbiAgICAgKi9cbiAgICBwcml2YXRlIGFzeW5jIGluaXQoKTogUHJvbWlzZTxNYW5hZ2VyU3RhdGU+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAnUkVBRFknKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy51c2VDb25maWd1cmVkR3JhcGhGYWN0b3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBcIjswO1wiIGlzIGEgd2VpcmQgd29yayBhcm91bmQgdG8gcHJldmVudCBhbiBlcnJvciBiZWluZyB0aHJvd24uXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnN1Ym1pdChcbiAgICAgICAgICAgICAgICAgICAgICAgIGAke3RoaXMub3B0aW9ucy5ncmFwaE5hbWV9ID0gQ29uZmlndXJlZEdyYXBoRmFjdG9yeS5vcGVuKCcke3RoaXMub3B0aW9ucy5ncmFwaE5hbWV9Jyk7MDtgXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuY29uZmlnUGF0aCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LnN1Ym1pdChcbiAgICAgICAgICAgICAgICAgICAgICAgIGAke3RoaXMub3B0aW9ucy5ncmFwaE5hbWV9ID0gSmFudXNHcmFwaEZhY3Rvcnkub3BlbignJHt0aGlzLm9wdGlvbnMuY29uZmlnUGF0aH0nKTswO2BcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jbGllbnQuc3VibWl0KHRoaXMuT1BFTl9NR01UKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gJ1JFQURZJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5zdGF0ZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdFUlJPUic7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGNyZWF0ZUdyYXBoSW5kZXgoaW5kZXg6IEdyYXBoSW5kZXgsIGNvbW1pdCA9IGZhbHNlKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5pbml0KCk7XG4gICAgICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgR3JhcGhJbmRleEJ1aWxkZXIoaW5kZXgubmFtZSk7XG4gICAgICAgIGJ1aWxkZXIubGFiZWwoaW5kZXgubGFiZWwpLnR5cGUoaW5kZXgudHlwZSkudW5pcXVlKGluZGV4LnVuaXF1ZSk7XG4gICAgICAgIGluZGV4LmtleXMuZm9yRWFjaCgoaykgPT4gYnVpbGRlci5rZXkoaykpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jbGllbnQuc3VibWl0KGJ1aWxkZXIuYnVpbGQoKSk7XG4gICAgICAgICAgICBpZiAoY29tbWl0KSBhd2FpdCB0aGlzLmNvbW1pdCgpO1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgxKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGNyZWF0ZVZlcnRleENlbnRyaWNJbmRleChpbmRleDogVmVydGV4Q2VudHJpY0luZGV4LCBjb21taXQgPSBmYWxzZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXQoKTtcbiAgICAgICAgICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgVmVydGV4Q2VudHJpY0luZGV4QnVpbGRlcihcbiAgICAgICAgICAgICAgICBpbmRleC5uYW1lXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgYnVpbGRlclxuICAgICAgICAgICAgICAgIC5kaXJlY3Rpb24oaW5kZXguZGlyZWN0aW9uKVxuICAgICAgICAgICAgICAgIC5lZGdlbGFiZWwoaW5kZXguZWRnZWxhYmVsKVxuICAgICAgICAgICAgICAgIC5vcmRlcihpbmRleC5vcmRlcik7XG4gICAgICAgICAgICBpbmRleC5rZXlzLmZvckVhY2goKGspID0+IGJ1aWxkZXIua2V5KGspKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jbGllbnQuc3VibWl0KGJ1aWxkZXIuYnVpbGQoKSk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbW1pdCkgYXdhaXQgdGhpcy5jb21taXQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDEpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV2lsbCBidWlsZCBvbmx5IHRoZSBpbmRpY2VzIGZyb20gYSBncmFwaCBzY2hlbWEuXG4gICAgICogQHBhcmFtIHNjaGVtYSAtIEdyYXBoU2NoZW1hIHRvIGdldCBpbmRleCBkZWZpbml0aW9ucyBmcm9tLlxuICAgICAqIEBwYXJhbSBjb21taXQgLSBXaGV0aGVyIG9yIG5vdCB0byBjb21taXQgYW5kIGNsb3NlIHRoZSB0cmF2ZXJzYWwuIERlZmF1bHQ6IGBmYWxzZWBcbiAgICAgKiBAcmV0dXJucyBBIHByb21pc2UgY29udGFpbmluZyB0aGUgbnVtYmVyIG9mIHN1Y2Nlc3NmdWwgdHJhdmVyc2FscyBtYWRlLlxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZUluZGljZXMoc2NoZW1hOiBHcmFwaFNjaGVtYSwgY29tbWl0ID0gZmFsc2UpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5pbml0KCk7XG4gICAgICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICAgICAgLy8gR2VuZXJhdGUgZ3JhcGggaW5kaWNlcy5cbiAgICAgICAgICAgIGNvdW50ICs9IChcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1hLmdyYXBoSW5kaWNlcy5tYXAoKGkpID0+IHRoaXMuY3JlYXRlR3JhcGhJbmRleChpLCBjb21taXQpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkubGVuZ3RoO1xuICAgICAgICAgICAgLy8gR2VuZXJhdGUgdmMgaW5kaWNlcy5cbiAgICAgICAgICAgIGNvdW50ICs9IChcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1hLnZjSW5kaWNlcy5tYXAoKGkpID0+IHRoaXMuY3JlYXRlVmVydGV4Q2VudHJpY0luZGV4KGksIGNvbW1pdCkpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKS5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoY29tbWl0KSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21taXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY291bnQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXR0ZW1wdHMgdG8gZW5hYmxlIGluZGljZXMuXG4gICAgICogQHBhcmFtIHNjaGVtYSAtIEdyYXBoU2NoZW1hIHRvIGVuYWJsZSBpbmRpY2llcyBmb3IuXG4gICAgICogQHBhcmFtIGNvbW1pdCAtIFdoZXRoZXIgb3Igbm90IHRvIGNvbW1pdCBhbmQgY2xvc2UgdGhlIHRyYXZlcnNhbC4gRGVmYXVsdDogYGZhbHNlYFxuICAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSBjb250YWluaW5nIHRoZSBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCB0cmF2ZXJzYWxzIG1hZGUuXG4gICAgICovXG4gICAgYXN5bmMgZW5hYmxlSW5kaWNlcyhzY2hlbWE6IEdyYXBoU2NoZW1hLCBjb21taXQgPSBmYWxzZSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXQoKTtcbiAgICAgICAgICAgIGNvbnN0IGdpID0gc2NoZW1hLmdyYXBoSW5kaWNlcy5tYXAoKGkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IEVuYWJsZUluZGV4QnVpbGRlcihpLm5hbWUsIHNjaGVtYS5uYW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCB2Y2kgPSBzY2hlbWEudmNJbmRpY2VzLm1hcCgoaSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgRW5hYmxlSW5kZXhCdWlsZGVyKGkubmFtZSwgc2NoZW1hLm5hbWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBidWlsZGVyLnR5cGUoJ1ZlcnRleENlbnRyaWMnKS5sYWJlbChpLmVkZ2VsYWJlbCkuYnVpbGQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgY291bnQgPSBbLi4uZ2ksIC4uLnZjaV0ubWFwKChtc2cpID0+IHRoaXMuY2xpZW50LnN1Ym1pdChtc2cpKVxuICAgICAgICAgICAgICAgIC5sZW5ndGg7XG4gICAgICAgICAgICBpZiAoY29tbWl0KSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jb21taXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY291bnQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbGwgdGhlIHNjaGVtYSBkZWZpbml0aW9ucy5cbiAgICAgKiBAcGFyYW0gc2NoZW1hIC0gR3JhcGhTY2hlbWEgdG8gZ2V0IHNjaGVtYSBkZWZpbml0aW9ucyBmcm9tLlxuICAgICAqIEBwYXJhbSBpbmRpY2VzIC0gSWYgc2V0IGB0cnVlYCwgd2lsbCBidWlsZCBpbmRpY2VzIGFzIHdlbGwuIERlZmF1bHQgYGZhbHNlYC5cbiAgICAgKiBAcmV0dXJucyBBIHByb21pc2UgY29udGFpbmluZyB0aGUgbnVtYmVyIG9mIHN1Y2Nlc3NmdWwgdHJhdmVyc2FscyBtYWRlLlxuICAgICAqL1xuICAgIGFzeW5jIGNyZWF0ZVNjaGVtYShzY2hlbWE6IEdyYXBoU2NoZW1hLCBpbmRpY2VzID0gZmFsc2UpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5pbml0KCk7XG4gICAgICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICAgICAgLy8gRXh0cmFjdC9CdWlsZCBvdXIgcHJvcGVydGllcyBkZWZpbml0aW9ucy5cbiAgICAgICAgICAgIGNvdW50ICs9IChcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICAgICAgICAgICAgWy4uLnNjaGVtYS52ZXJ0aWNlcywgLi4uc2NoZW1hLmVkZ2VzXVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZsYXRNYXAoKHYpID0+IHYucHJvcGVydGllcylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKHApID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IFByb3BlcnR5QnVpbGRlcihwLmtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGF0eXBlKHAuZGF0YXR5cGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXJkaW5hbGl0eShwLmNhcmRpbmFsaXR5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYnVpbGQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKChtc2cpID0+IHRoaXMuY2xpZW50LnN1Ym1pdChtc2cpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkubGVuZ3RoO1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGxhYmVscyBhbmQgYXNzb2NpYXRlIHByb3BlcnRpZXMgZm9yIHZlcnRpY2VzLlxuICAgICAgICAgICAgY291bnQgKz0gKFxuICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgICAgICAgICAgICBzY2hlbWEudmVydGljZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKHYpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IFZlcnRleEJ1aWxkZXIodi5sYWJlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5wcm9wZXJ0aWVzLmZvckVhY2goKHApID0+IGJ1aWxkZXIucHJvcGVydHkocCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgobXNnKSA9PiB0aGlzLmNsaWVudC5zdWJtaXQobXNnKSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApLmxlbmd0aDtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBsYWJlbHMgYW5kIGFzc29jaWF0ZSBwcm9wZXJ0aWVzIGZvciBlZGdlcy5cbiAgICAgICAgICAgIGNvdW50ICs9IChcbiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1hLmVkZ2VzXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBFZGdlQnVpbGRlcihlLmxhYmVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByb3BlcnRpZXMuZm9yRWFjaCgocCkgPT4gYnVpbGRlci5wcm9wZXJ0eShwKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKChtc2cpID0+IHRoaXMuY2xpZW50LnN1Ym1pdChtc2cpKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGluZGljZXMpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNvbW1pdCgpO1xuICAgICAgICAgICAgICAgIGNvdW50ICs9IGF3YWl0IHRoaXMuY3JlYXRlSW5kaWNlcyhzY2hlbWEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjb3VudCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMZXZlcmFnZXMgdGhlIGdyZW1saW4gY2xpZW50IHRvIGNvbW1pdCBhIG1hbmFnZW1lbnQgbWVzc2FnZS5cbiAgICAgKiBAcGFyYW0gbWVzc2FnZSBNZXNzYWdlIHRvIHNlbmQgcHJpb3IgdG8gdGhlIGNvbW1pdC4gTm90IHJlcXVpcmVkLlxuICAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSBmcm9tIGNsaWVudCBjb21taXQgc3VibWlzc2lvbi5cbiAgICAgKi9cbiAgICBhc3luYyBjb21taXQobWVzc2FnZT86IHN0cmluZyk6IFByb21pc2U8dW5rbm93bj4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5pbml0KCk7XG4gICAgICAgICAgICBjb25zdCBjb21taXQgPSBhd2FpdCB0aGlzLmNsaWVudC5zdWJtaXQoXG4gICAgICAgICAgICAgICAgYCR7bWVzc2FnZSA/PyAnJ307bWdtdC5jb21taXQoKTtgXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9ICdDT01NSVQnO1xuICAgICAgICAgICAgcmV0dXJuIGNvbW1pdDtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gJ0VSUk9SJztcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXR0ZW1wdHMgdG8gY2xvc2UgdGhlIGdyZW1saW4gY2xpZW50LlxuICAgICAqIEByZXR1cm5zIEEgcHJvbWlzZSB3aXRoIGNsb3NlIHN0YXR1cy0tIGRlZmVycyB0byB7QHNlZSBkcml2ZXIuQ2xpZW50LnByb3RvdHlwZS5jbG9zZSgpfVxuICAgICAqL1xuICAgIGFzeW5jIGNsb3NlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKFsnQ0xPU0VEJywgJ0VSUk9SJ10uc29tZSgocykgPT4gcyA9PT0gdGhpcy5zdGF0ZSkpIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IGNsb3NlID0gYXdhaXQgdGhpcy5jbGllbnQuY2xvc2UoKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAnQ0xPU0VEJztcbiAgICAgICAgICAgIHJldHVybiBjbG9zZTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gJ0VSUk9SJztcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==